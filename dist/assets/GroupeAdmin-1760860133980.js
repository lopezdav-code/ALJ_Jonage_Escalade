import{l as H,w as z,x as B,r as a,y as n,j as e,z as F,H as M,D as G,m as o,a9 as P,F as J,G as b,J as E,K as S,W as A,o as K,p as U,q as f,s as v,t as W,v as h,n as O,T as Q,M as V,I as X}from"./index-1760860133980.js";import{S as Y}from"./save-1760860133980.js";const ee=()=>{const m=H(),{toast:i}=z(),{isAdmin:d,loading:x}=B(),[j,C]=a.useState([]),[T,y]=a.useState(!0),[Z,R]=a.useState(null),[l,u]=a.useState(null),[p,c]=a.useState(""),[w,N]=a.useState(!1);a.useEffect(()=>{if(!x&&!d){m("/");return}d&&g()},[d,x,m]);const g=async()=>{y(!0);try{try{const t=await n.auth.getSession(),q=await n.auth.getUser();console.log("[GroupeAdmin] auth sessionRes:",t),console.log("[GroupeAdmin] auth userRes:",q)}catch(t){console.warn("[GroupeAdmin] could not get auth session/user",t)}const{data:s,error:r}=await n.from("groupe").select("*");if(console.log("[GroupeAdmin] fetchGroupes response:",{data:s,error:r}),R({data:s,error:r}),r)throw r;C(s||[])}catch(s){console.error("Erreur chargement groupes:",s),i({title:"Erreur",description:"Impossible de charger les groupes.",variant:"destructive"})}finally{y(!1)}},D=s=>{u(s),c(s.description||"")},L=()=>{u({id:null}),c("")},I=async s=>{if(s.preventDefault(),!p.trim()){i({title:"Erreur",description:"La description est requise.",variant:"destructive"});return}N(!0);try{if(l&&l.id){const{data:r,error:t}=await n.from("groupe").update({description:p.trim()}).eq("id",l.id).select();if(console.log("[GroupeAdmin] update response:",{data:r,error:t}),t)throw t;i({title:"Groupe modifié"})}else{const{data:r,error:t}=await n.from("groupe").insert([{description:p.trim()}]).select();if(console.log("[GroupeAdmin] insert response:",{data:r,error:t}),t)throw t;i({title:"Groupe créé"})}u(null),c(""),g()}catch(r){console.error("Erreur sauvegarde groupe:",r),i({title:"Erreur",description:r.message||"Impossible de sauvegarder.",variant:"destructive"})}finally{N(!1)}},k=async s=>{if(confirm("Supprimer ce groupe ?"))try{const{data:r,error:t}=await n.from("groupe").delete().eq("id",s).select();if(console.log("[GroupeAdmin] delete response:",{data:r,error:t}),t)throw t;i({title:"Groupe supprimé"}),g()}catch(r){console.error("Erreur suppression groupe:",r),i({title:"Erreur",description:"Impossible de supprimer le groupe.",variant:"destructive"})}};return x||T?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(F,{className:"w-12 h-12 animate-spin text-primary"})}):d?e.jsxs("div",{className:"space-y-8 max-w-4xl mx-auto p-6",children:[e.jsx(M,{children:e.jsx("title",{children:"Gestion des groupes"})}),e.jsx(G.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"ghost",onClick:()=>m(-1),children:[e.jsx(P,{className:"w-4 h-4 mr-2"})," Retour"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Gestion des groupes"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{onClick:L,children:[e.jsx(J,{className:"w-4 h-4 mr-2"})," Nouveau groupe"]})})]})}),e.jsxs(b,{children:[e.jsx(E,{children:e.jsxs(S,{children:["Liste des groupes (",j.length,")"]})}),e.jsx(A,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(K,{children:[e.jsx(U,{children:e.jsxs(f,{children:[e.jsx(v,{children:"ID"}),e.jsx(v,{children:"Description"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(W,{children:j.length===0?e.jsx(f,{children:e.jsx(h,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"Aucun groupe"})}):j.map(s=>e.jsxs(f,{children:[e.jsx(h,{className:"font-mono text-sm",children:s.id}),e.jsx(h,{children:s.description}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>D(s),children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx(o,{variant:"destructive",size:"sm",onClick:()=>k(s.id),children:e.jsx(Q,{className:"w-4 h-4"})})]})})]},s.id))})]})})})]}),l!==null&&e.jsx(G.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},children:e.jsxs(b,{children:[e.jsx(E,{children:e.jsx(S,{children:l.id?"Modifier le groupe":"Nouveau groupe"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Description"}),e.jsx(X,{value:p,onChange:s=>c(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"ghost",onClick:()=>{u(null),c("")},children:"Annuler"}),e.jsxs(o,{type:"submit",disabled:w,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),w?"Enregistrement...":"Enregistrer"]})]})]})})]})})]}):null};export{ee as default};
