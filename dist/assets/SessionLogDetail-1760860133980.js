import{Y as H,a6 as P,l as z,r as h,j as e,a8 as G,m as $,a9 as O,G as M,J as q,K as L,W as A,aa as V,ab as I,ac as g,B as d,ad as J,ae as B,y as c}from"./index-1760860133980.js";import{T as K}from"./target-1760860133980.js";const U=H("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),W=H("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),X=()=>{var b,_,v,y,w;const{id:o}=P(),p=z(),[a,R]=h.useState(null),[T,f]=h.useState(!0),[j,N]=h.useState(null);return h.useEffect(()=>{o?(async()=>{try{const{data:n,error:m}=await c.from("sessions").select(`
            *,
            cycles (
              name,
              short_description
            ),
            exercises (
              id,
              operational_objective,
              situation,
              organisation,
              consigne,
              time,
              success_criteria,
              regulation,
              support_link,
              image_url,
              pedagogy_sheet_id,
              order
            )
          `).eq("id",o).single();if(m)throw m;let k=null;if(n.schedule_id)try{const{data:r,error:t}=await c.from("schedules").select("id, type, age_category, day, start_time, end_time").eq("id",n.schedule_id).single();!t&&r&&(k=r)}catch{}const D=[...n.instructors||[],...n.students||[],...n.absent_students||[]];let u={};if(D.length>0){const{data:r,error:t}=await c.from("secure_members").select("id, first_name, last_name").in("id",D);if(t)throw t;u=(r||[]).reduce((i,l)=>(i[l.id]={id:l.id,fullName:`${l.first_name} ${l.last_name}`,firstName:l.first_name,lastName:l.last_name},i),{})}let S={};if(n.students&&n.students.length>0){const{data:r,error:t}=await c.from("student_session_comments").select("member_id, comment").eq("session_id",o).in("member_id",n.students);if(t)throw t;S=(r||[]).reduce((i,l)=>(i[l.member_id]=l.comment,i),{})}const C=(n.exercises||[]).map(r=>r.pedagogy_sheet_id).filter(Boolean);let E={};if(C.length>0){const{data:r,error:t}=await c.from("pedagogy_sheets").select("id, title, sheet_type").in("id",C);if(t)throw t;E=(r||[]).reduce((i,l)=>(i[l.id]=l,i),{})}let x=[];try{const{data:r,error:t}=await c.from("members").select("id, first_name, last_name").eq("title","Loisir lycée").order("last_name").order("first_name");t?console.warn("Erreur en récupérant les membres lycéens:",t):x=r||[]}catch(r){console.warn("Exception en récupérant les membres lycéens:",r)}const Y=(x||[]).reduce((r,t)=>(r[t.id]={id:t.id,fullName:`${t.first_name} ${t.last_name}`,firstName:t.first_name,lastName:t.last_name},r),{}),F={...n,schedule:k,instructorNames:(n.instructors||[]).map(r=>{var t;return((t=u[r])==null?void 0:t.fullName)||`ID: ${r}`}),studentNames:(n.students||[]).map(r=>{var t;return((t=u[r])==null?void 0:t.fullName)||`ID: ${r}`}),studentsData:(n.students||[]).map(r=>({...u[r]||{id:r,fullName:`ID: ${r}`,firstName:"",lastName:""},comment:S[r]||""})),absentNames:(()=>{const r=new Set(n.students||[]);return(x||[]).filter(t=>!r.has(t.id)).map(t=>`${t.first_name} ${t.last_name}`)})(),absentData:(()=>{const r=new Set(n.students||[]);return(x||[]).filter(t=>!r.has(t.id)).map(t=>({id:t.id,fullName:`${t.first_name} ${t.last_name}`,firstName:t.first_name,lastName:t.last_name}))})(),exercises:(n.exercises||[]).map(r=>({...r,pedagogy_sheet:r.pedagogy_sheet_id?E[r.pedagogy_sheet_id]:null}))};R(F)}catch(n){console.error("General error in fetchSessionDetail:",n),N(n.message)}finally{f(!1)}})():(N("Session ID is missing."),f(!1))},[o]),T?e.jsx("div",{className:"container mx-auto p-4",children:"Chargement des détails de la séance..."}):j?e.jsxs("div",{className:"container mx-auto p-4 text-red-500",children:["Erreur: ",j]}):a?e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsx(G,{title:`Détail de la séance - ${a.date?new Date(a.date).toLocaleDateString():"Sans date"}`}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{variant:"outline",onClick:()=>p("/session-log"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Détail de la séance"})]}),e.jsxs($,{onClick:()=>p(`/session-log/edit/${o}`),children:[" ","Modifier la séance"]})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(L,{children:"Informations générales"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-medium",children:a.date?new Date(a.date).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Non spécifiée"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Heure de début"}),e.jsx("p",{className:"font-medium",children:a.start_time||"Non spécifiée"})]})]})]}),a.cycles&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("p",{className:"font-semibold text-blue-900 dark:text-blue-100",children:["Cycle: ",a.cycles.name]}),a.cycles.short_description&&e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:a.cycles.short_description})]}),a.schedule&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-950 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[e.jsxs("p",{className:"font-semibold text-purple-900 dark:text-purple-100",children:["Emploi du temps: ",a.schedule.type," - ",a.schedule.age_category]}),e.jsxs("p",{className:"text-sm text-purple-700 dark:text-purple-300 mt-1",children:[a.schedule.day," de ",a.schedule.start_time," à ",a.schedule.end_time]})]}),a.session_objective&&e.jsxs("div",{className:"border-l-4 border-primary pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"font-semibold",children:"Objectif de séance"})]}),e.jsx("p",{className:"text-muted-foreground",children:a.session_objective})]}),a.equipment&&e.jsxs("div",{className:"border-l-4 border-orange-500 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-orange-500"}),e.jsx("p",{className:"font-semibold",children:"Matériel"})]}),e.jsx("p",{className:"text-muted-foreground",children:a.equipment})]}),a.comment&&e.jsxs("div",{className:"border-l-4 border-purple-500 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-5 h-5 text-purple-500"}),e.jsx("p",{className:"font-semibold",children:"Commentaire"})]}),e.jsx("p",{className:"text-muted-foreground",children:a.comment})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(g,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("p",{className:"font-semibold",children:["Encadrants (",((b=a.instructorNames)==null?void 0:b.length)||0,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(_=a.instructorNames)==null?void 0:_.map((s,n)=>e.jsx(d,{variant:"secondary",className:"text-sm py-1 px-3",children:s},n))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(g,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("p",{className:"font-semibold",children:["Élèves présents (",((v=a.studentsData)==null?void 0:v.length)||0,")"]})]}),a.studentsData&&a.studentsData.length>0?e.jsxs("div",{className:"space-y-3",children:[a.studentsData.filter(s=>!s.comment).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:a.studentsData.filter(s=>!s.comment).map((s,n)=>e.jsx(d,{variant:"outline",className:"text-sm py-1.5 px-3 bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800 text-green-900 dark:text-green-100",children:s.fullName},n))}),a.studentsData.filter(s=>s.comment).map((s,n)=>e.jsx("div",{className:"border rounded-lg p-3 bg-green-50/50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(d,{variant:"outline",className:"text-sm py-1 px-3 bg-green-100 dark:bg-green-900 border-green-300 dark:border-green-700 text-green-900 dark:text-green-100 whitespace-nowrap",children:s.fullName}),e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',s.comment,'"']})})]})},n))]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun élève enregistré"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(g,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("p",{className:"font-semibold",children:["Élèves absents (",((y=a.absentData)==null?void 0:y.length)||0,")"]})]}),a.absentData&&a.absentData.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:a.absentData.map((s,n)=>e.jsx(d,{variant:"outline",className:"text-sm py-1.5 px-3 bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-800 text-red-900 dark:text-red-100",children:s.fullName},n))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun élève absent enregistré"})]})]})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsxs(L,{children:["Déroulé de la séance (",((w=a.exercises)==null?void 0:w.length)||0," exercices)"]})}),e.jsx(A,{children:a.exercises&&a.exercises.length>0?e.jsx("div",{className:"space-y-6",children:a.exercises.map((s,n)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(d,{variant:"outline",className:"font-mono",children:["#",n+1]}),e.jsx("h3",{className:"text-lg font-semibold",children:s.operational_objective||"Sans titre"})]}),s.pedagogy_sheet&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(J,{className:"w-4 h-4 text-blue-500"}),e.jsxs("button",{onClick:()=>p(`/pedagogy-sheets/${s.pedagogy_sheet_id}`),className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:["Fiche pédagogique: ",s.pedagogy_sheet.title,e.jsx(B,{className:"w-3 h-3"})]})]})]}),s.time&&e.jsxs(d,{variant:"secondary",className:"whitespace-nowrap",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),s.time]})]}),s.image_url&&e.jsx("div",{className:"my-3",children:e.jsx("img",{src:s.image_url,alt:s.operational_objective||"Image exercice",className:"max-w-full h-auto rounded-lg border shadow-sm max-h-96 object-contain",onError:m=>{m.target.style.display="none"}})}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[s.situation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Situation"}),e.jsx("p",{className:"text-foreground",children:s.situation})]}),s.organisation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Organisation"}),e.jsx("p",{className:"text-foreground",children:s.organisation})]}),s.consigne&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Consigne"}),e.jsx("p",{className:"text-foreground",children:s.consigne})]}),s.success_criteria&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Critères de réussite"}),e.jsx("p",{className:"text-foreground",children:s.success_criteria})]}),s.regulation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Régulation"}),e.jsx("p",{className:"text-foreground",children:s.regulation})]}),s.support_link&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Lien de support"}),e.jsxs("a",{href:s.support_link,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline flex items-center gap-1",children:[s.support_link,e.jsx(B,{className:"w-3 h-3"})]})]})]})]},s.id))}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucun exercice enregistré pour cette séance."})})]})]}):e.jsx("div",{className:"container mx-auto p-4",children:"Séance non trouvée."})};export{X as default};
