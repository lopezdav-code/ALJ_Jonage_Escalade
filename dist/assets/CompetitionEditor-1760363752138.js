import{u as H,a0 as G,O as K,r as h,t as v,j as e,B as o,a1 as Q,C as p,b as x,d as g,aH as _,e as j,L as a,I as n,n as y,o as w,p as E,q as S,s as F,aK as X,T as L,aL as $,X as J}from"./index-1760363752138.js";import{U as W}from"./upload-1760363752138.js";import{S as Y}from"./save-1760363752138.js";const ie=()=>{const f=H(),{id:m}=G(),{toast:l}=K(),u=!!m,k={Bloc:"Escalade sur murs de 4,5m sans corde, résolution de problèmes courts et intenses",Difficulté:"Escalade en hauteur (15m+) avec corde, un seul essai pour monter le plus haut possible",Vitesse:"Duel sur voie standardisée de 15m, objectif: temps le plus rapide",Combiné:"Format olympique combinant Bloc et Difficulté en un seul classement"},[t,d]=h.useState({name:"",short_title:"",start_date:"",end_date:"",location:"",prix:"",niveau:"",nature:"",disciplines:[],categories:[],more_info_link:"",details_description:"",details_format:"",details_schedule:"",image_url:"",photo_gallery:[]}),[D,C]=h.useState(!1),[N,b]=h.useState(!1),I=["Départemental","Régional","Inter-régional","National","International"],U=["Contest","Open","Coupe","Championnat"],q=["Bloc","Difficulté","Vitesse","Combiné"],B=["U11","U13","U15","U17","U19","Sénior","Vétéran"];h.useEffect(()=>{u&&O()},[m]);const O=async()=>{C(!0);try{const{data:s,error:i}=await v.from("competitions").select("*").eq("id",m).single();if(i)throw i;d({name:s.name||"",short_title:s.short_title||"",start_date:s.start_date||"",end_date:s.end_date||"",location:s.location||"",prix:s.prix||"",niveau:s.niveau||"",nature:s.nature||"",disciplines:s.disciplines||[],categories:s.categories||[],more_info_link:s.more_info_link||"",details_description:s.details_description||"",details_format:s.details_format||"",details_schedule:s.details_schedule||"",image_url:s.image_url||"",photo_gallery:s.photo_gallery||[]})}catch(s){console.error("Erreur lors du chargement:",s),l({title:"Erreur",description:"Impossible de charger la compétition.",variant:"destructive"})}finally{C(!1)}},r=(s,i)=>{d(c=>({...c,[s]:i}))},R=s=>{d(i=>({...i,disciplines:i.disciplines.includes(s)?i.disciplines.filter(c=>c!==s):[...i.disciplines,s]}))},T=s=>{d(i=>({...i,categories:i.categories.includes(s)?i.categories.filter(c=>c!==s):[...i.categories,s]}))},V=()=>{const s=prompt("URL de la photo:");s&&d(i=>({...i,photo_gallery:[...i.photo_gallery,s]}))},z=s=>{d(i=>({...i,photo_gallery:i.photo_gallery.filter((c,M)=>M!==s)}))},P=()=>t.name.trim()?t.start_date?t.location.trim()?t.end_date&&t.end_date<t.start_date?(l({title:"Erreur",description:"La date de fin ne peut pas être antérieure à la date de début.",variant:"destructive"}),!1):!0:(l({title:"Erreur",description:"Le lieu est obligatoire.",variant:"destructive"}),!1):(l({title:"Erreur",description:"La date de début est obligatoire.",variant:"destructive"}),!1):(l({title:"Erreur",description:"Le nom de la compétition est obligatoire.",variant:"destructive"}),!1),A=async()=>{if(P()){b(!0);try{const s={...t,prix:t.prix?parseFloat(t.prix):null,end_date:t.end_date||null};if(u){const{error:i}=await v.from("competitions").update(s).eq("id",m);if(i)throw i;l({title:"Succès",description:"Compétition modifiée avec succès !",variant:"default"})}else{const{error:i}=await v.from("competitions").insert([s]);if(i)throw i;l({title:"Succès",description:"Compétition créée avec succès !",variant:"default"})}f("/competitions")}catch(s){console.error("Erreur lors de la sauvegarde:",s),l({title:"Erreur",description:"Impossible de sauvegarder la compétition.",variant:"destructive"})}finally{b(!1)}}};return D?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"outline",onClick:()=>f("/competitions"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:u?"Modifier la compétition":"Créer une compétition"}),e.jsx("p",{className:"text-muted-foreground",children:u?"Modifiez les informations de la compétition":"Ajoutez une nouvelle compétition au club"})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Informations générales"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"name",children:"Nom de la compétition *"}),e.jsx(n,{id:"name",value:t.name,onChange:s=>r("name",s.target.value),placeholder:"Ex: Championnat Régional d'Escalade"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"short_title",children:"Titre court"}),e.jsx(n,{id:"short_title",value:t.short_title,onChange:s=>r("short_title",s.target.value),placeholder:"Ex: Régional Escalade 2024"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"start_date",children:"Date de début *"}),e.jsx(n,{id:"start_date",type:"date",value:t.start_date,onChange:s=>r("start_date",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"end_date",children:"Date de fin"}),e.jsx(n,{id:"end_date",type:"date",value:t.end_date,onChange:s=>r("end_date",s.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"location",children:"Lieu *"}),e.jsx(n,{id:"location",value:t.location,onChange:s=>r("location",s.target.value),placeholder:"Ex: Salle d'escalade de Lyon"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"prix",children:"Prix d'entrée (€)"}),e.jsx(n,{id:"prix",type:"number",step:"0.01",value:t.prix,onChange:s=>r("prix",s.target.value),placeholder:"Ex: 25.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"niveau",children:"Niveau"}),e.jsxs(y,{value:t.niveau,onValueChange:s=>r("niveau",s),children:[e.jsx(w,{children:e.jsx(E,{placeholder:"Sélectionner un niveau"})}),e.jsx(S,{children:I.map(s=>e.jsx(F,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{htmlFor:"nature",children:"Nature"}),e.jsx(_,{className:"w-4 h-4 text-muted-foreground cursor-help",title:"Contest: Compétition locale ou régionale | Open: Compétition ouverte à tous | Coupe: Compétition officielle d'un circuit | Championnat: Compétition de haut niveau"})]}),e.jsxs(y,{value:t.nature,onValueChange:s=>r("nature",s),children:[e.jsx(w,{children:e.jsx(E,{placeholder:"Sélectionner une nature"})}),e.jsx(S,{children:U.map(s=>e.jsx(F,{value:s,children:s},s))})]})]})]})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(g,{children:"Disciplines et catégories"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{children:"Disciplines"}),e.jsx(_,{className:"w-4 h-4 text-muted-foreground cursor-help",title:"Bloc: Sprint sur 4,5m, résolution de problèmes | Difficulté: Marathon en hauteur, un essai | Vitesse: Duel rapide sur voie standardisée | Combiné: Format olympique bloc + difficulté"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:q.map(s=>e.jsx(o,{variant:t.disciplines.includes(s)?"default":"outline",size:"sm",onClick:()=>R(s),title:k[s],children:s},s))})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Catégories"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:B.map(s=>e.jsx(o,{variant:t.categories.includes(s)?"default":"outline",size:"sm",onClick:()=>T(s),children:s},s))})]})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Liens et informations pratiques"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"more_info_link",children:"Lien pour plus d'informations"}),e.jsx(n,{id:"more_info_link",type:"url",value:t.more_info_link,onChange:s=>r("more_info_link",s.target.value),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"details_description",children:"Informations pratiques"}),e.jsx(L,{id:"details_description",value:t.details_description,onChange:s=>r("details_description",s.target.value),placeholder:"Horaires, matériel requis, consignes...",rows:3})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"details_format",children:"Format de la compétition"}),e.jsx(L,{id:"details_format",value:t.details_format,onChange:s=>r("details_format",s.target.value),placeholder:"Qualification, demi-finales, finales...",rows:3})]})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Images"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"image_url",children:"Image principale (URL)"}),e.jsx(n,{id:"image_url",type:"url",value:t.image_url,onChange:s=>r("image_url",s.target.value),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(a,{children:"Galerie photo"}),e.jsxs(o,{variant:"outline",size:"sm",onClick:V,children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Ajouter une photo"]})]}),t.photo_gallery.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:t.photo_gallery.map((s,i)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s,alt:`Photo ${i+1}`,className:"w-full h-20 object-cover rounded border"}),e.jsx(o,{variant:"destructive",size:"sm",className:"absolute top-1 right-1 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>z(i),children:e.jsx(J,{className:"w-3 h-3"})})]},i))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pb-8",children:[e.jsx(o,{variant:"outline",onClick:()=>f("/competitions"),children:"Annuler"}),e.jsx(o,{onClick:A,disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Sauvegarde..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),u?"Modifier":"Créer"]})})]})]})};export{ie as default};
