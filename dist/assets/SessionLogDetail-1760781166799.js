import{Y as B,a6 as T,l as F,r as x,j as e,a8 as P,m as S,a9 as z,G as C,J as E,K as M,W as q,aa as G,ab as L,ac as $,B as c,ad as O,ae as A,y as o}from"./index-1760781166799.js";import{T as V}from"./target-1760781166799.js";const J=B("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),K=B("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),Y=()=>{var j,N,b,v;const{id:d}=T(),h=F(),[t,H]=x.useState(null),[I,p]=x.useState(!0),[g,f]=x.useState(null);return x.useEffect(()=>{d?(async()=>{try{const{data:r,error:m}=await o.from("sessions").select(`
            *,
            cycles (
              name,
              short_description
            ),
            exercises (
              id,
              operational_objective,
              situation,
              organisation,
              consigne,
              time,
              success_criteria,
              regulation,
              support_link,
              image_url,
              pedagogy_sheet_id,
              order
            )
          `).eq("id",d).single();if(m)throw m;let y=null;if(r.schedule_id)try{const{data:a,error:n}=await o.from("schedules").select("id, type, age_category, day, start_time, end_time").eq("id",r.schedule_id).single();!n&&a&&(y=a)}catch{}const _=[...r.instructors||[],...r.students||[]];let u={};if(_.length>0){const{data:a,error:n}=await o.from("secure_members").select("id, first_name, last_name").in("id",_);if(n)throw n;u=(a||[]).reduce((i,l)=>(i[l.id]={id:l.id,fullName:`${l.first_name} ${l.last_name}`,firstName:l.first_name,lastName:l.last_name},i),{})}let w={};if(r.students&&r.students.length>0){const{data:a,error:n}=await o.from("student_session_comments").select("member_id, comment").eq("session_id",d).in("member_id",r.students);if(n)throw n;w=(a||[]).reduce((i,l)=>(i[l.member_id]=l.comment,i),{})}const k=(r.exercises||[]).map(a=>a.pedagogy_sheet_id).filter(Boolean);let D={};if(k.length>0){const{data:a,error:n}=await o.from("pedagogy_sheets").select("id, title, sheet_type").in("id",k);if(n)throw n;D=(a||[]).reduce((i,l)=>(i[l.id]=l,i),{})}const R={...r,schedule:y,instructorNames:(r.instructors||[]).map(a=>{var n;return((n=u[a])==null?void 0:n.fullName)||`ID: ${a}`}),studentNames:(r.students||[]).map(a=>{var n;return((n=u[a])==null?void 0:n.fullName)||`ID: ${a}`}),studentsData:(r.students||[]).map(a=>({...u[a]||{id:a,fullName:`ID: ${a}`,firstName:"",lastName:""},comment:w[a]||""})),exercises:(r.exercises||[]).map(a=>({...a,pedagogy_sheet:a.pedagogy_sheet_id?D[a.pedagogy_sheet_id]:null}))};H(R)}catch(r){console.error("General error in fetchSessionDetail:",r),f(r.message)}finally{p(!1)}})():(f("Session ID is missing."),p(!1))},[d]),I?e.jsx("div",{className:"container mx-auto p-4",children:"Chargement des détails de la séance..."}):g?e.jsxs("div",{className:"container mx-auto p-4 text-red-500",children:["Erreur: ",g]}):t?e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsx(P,{title:`Détail de la séance - ${t.date?new Date(t.date).toLocaleDateString():"Sans date"}`}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(S,{variant:"outline",onClick:()=>h("/session-log"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Détail de la séance"})]}),e.jsxs(S,{onClick:()=>h(`/session-log/edit/${d}`),children:[" ","Modifier la séance"]})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(M,{children:"Informations générales"})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-medium",children:t.date?new Date(t.date).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Non spécifiée"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Heure de début"}),e.jsx("p",{className:"font-medium",children:t.start_time||"Non spécifiée"})]})]})]}),t.cycles&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("p",{className:"font-semibold text-blue-900 dark:text-blue-100",children:["Cycle: ",t.cycles.name]}),t.cycles.short_description&&e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:t.cycles.short_description})]}),t.schedule&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-950 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[e.jsxs("p",{className:"font-semibold text-purple-900 dark:text-purple-100",children:["Emploi du temps: ",t.schedule.type," - ",t.schedule.age_category]}),e.jsxs("p",{className:"text-sm text-purple-700 dark:text-purple-300 mt-1",children:[t.schedule.day," de ",t.schedule.start_time," à ",t.schedule.end_time]})]}),t.session_objective&&e.jsxs("div",{className:"border-l-4 border-primary pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"font-semibold",children:"Objectif de séance"})]}),e.jsx("p",{className:"text-muted-foreground",children:t.session_objective})]}),t.equipment&&e.jsxs("div",{className:"border-l-4 border-orange-500 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-5 h-5 text-orange-500"}),e.jsx("p",{className:"font-semibold",children:"Matériel"})]}),e.jsx("p",{className:"text-muted-foreground",children:t.equipment})]}),t.comment&&e.jsxs("div",{className:"border-l-4 border-purple-500 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"w-5 h-5 text-purple-500"}),e.jsx("p",{className:"font-semibold",children:"Commentaire"})]}),e.jsx("p",{className:"text-muted-foreground",children:t.comment})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("p",{className:"font-semibold",children:["Encadrants (",((j=t.instructorNames)==null?void 0:j.length)||0,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(N=t.instructorNames)==null?void 0:N.map((s,r)=>e.jsx(c,{variant:"secondary",className:"text-sm py-1 px-3",children:s},r))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("p",{className:"font-semibold",children:["Élèves présents (",((b=t.studentsData)==null?void 0:b.length)||0,")"]})]}),t.studentsData&&t.studentsData.length>0?e.jsxs("div",{className:"space-y-3",children:[t.studentsData.filter(s=>!s.comment).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:t.studentsData.filter(s=>!s.comment).map((s,r)=>e.jsx(c,{variant:"outline",className:"text-sm py-1.5 px-3 bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-800 text-green-900 dark:text-green-100",children:s.fullName},r))}),t.studentsData.filter(s=>s.comment).map((s,r)=>e.jsx("div",{className:"border rounded-lg p-3 bg-green-50/50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(c,{variant:"outline",className:"text-sm py-1 px-3 bg-green-100 dark:bg-green-900 border-green-300 dark:border-green-700 text-green-900 dark:text-green-100 whitespace-nowrap",children:s.fullName}),e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',s.comment,'"']})})]})},r))]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun élève enregistré"})]})]})]}),e.jsxs(C,{children:[e.jsx(E,{children:e.jsxs(M,{children:["Déroulé de la séance (",((v=t.exercises)==null?void 0:v.length)||0," exercices)"]})}),e.jsx(q,{children:t.exercises&&t.exercises.length>0?e.jsx("div",{className:"space-y-6",children:t.exercises.map((s,r)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(c,{variant:"outline",className:"font-mono",children:["#",r+1]}),e.jsx("h3",{className:"text-lg font-semibold",children:s.operational_objective||"Sans titre"})]}),s.pedagogy_sheet&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(O,{className:"w-4 h-4 text-blue-500"}),e.jsxs("button",{onClick:()=>h(`/pedagogy-sheets/${s.pedagogy_sheet_id}`),className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:["Fiche pédagogique: ",s.pedagogy_sheet.title,e.jsx(A,{className:"w-3 h-3"})]})]})]}),s.time&&e.jsxs(c,{variant:"secondary",className:"whitespace-nowrap",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),s.time]})]}),s.image_url&&e.jsx("div",{className:"my-3",children:e.jsx("img",{src:s.image_url,alt:s.operational_objective||"Image exercice",className:"max-w-full h-auto rounded-lg border shadow-sm max-h-96 object-contain",onError:m=>{m.target.style.display="none"}})}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[s.situation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Situation"}),e.jsx("p",{className:"text-foreground",children:s.situation})]}),s.organisation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Organisation"}),e.jsx("p",{className:"text-foreground",children:s.organisation})]}),s.consigne&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Consigne"}),e.jsx("p",{className:"text-foreground",children:s.consigne})]}),s.success_criteria&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Critères de réussite"}),e.jsx("p",{className:"text-foreground",children:s.success_criteria})]}),s.regulation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Régulation"}),e.jsx("p",{className:"text-foreground",children:s.regulation})]}),s.support_link&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-muted-foreground mb-1",children:"Lien de support"}),e.jsxs("a",{href:s.support_link,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline flex items-center gap-1",children:[s.support_link,e.jsx(A,{className:"w-3 h-3"})]})]})]})]},s.id))}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Aucun exercice enregistré pour cette séance."})})]})]}):e.jsx("div",{className:"container mx-auto p-4",children:"Séance non trouvée."})};export{Y as default};
