import{x as T,w as E,ax as R,r as x,j as e,z as N,af as k,H as D,D as I,aE as O,G as $,J as z,K as F,ah as H,W as G,o as q,p as J,q as h,s as l,R as v,t as L,v as u,a0 as S,$ as M,m as V}from"./index-1760860133980.js";import{S as B}from"./save-1760860133980.js";const p=["admin","bureau","encadrant","adherent"],W=[{id:"member",label:"Membre"},{id:"schedule",label:"Planning (Schedule)"},{id:"exercise",label:"Exercice"},{id:"competition",label:"Compétition"},{id:"competition_participants",label:"Participants à une compétition"},{id:"cycle",label:"Cycle"},{id:"news",label:"Actualité (News)"},{id:"news_advanced",label:"Actualité (Actions avancées)"},{id:"passeport",label:"Passeport"},{id:"profile",label:"Profil utilisateur"},{id:"role",label:"Rôle utilisateur"},{id:"session",label:"Session"},{id:"student_session_comment",label:"Commentaire de session élève"}],P=["create","edit"],w=["delete","archive","view_unpublished"],X=()=>{const{isAdmin:K,loading:y}=T(),{toast:j}=E(),{config:d,updateConfig:_,loadingConfig:o}=R(),[m,f]=x.useState({}),[b,g]=x.useState(!1);x.useEffect(()=>{if(!o&&d.permissions_config)try{f(JSON.parse(d.permissions_config))}catch(s){console.error("Failed to parse permissions_config:",s)}},[d.permissions_config,o]);const C=(s,t,i,n)=>{f(c=>{const a={...c};return a[s]||(a[s]={}),a[s][t]||(a[s][t]=[]),n?a[s][t].includes(i)||a[s][t].push(i):a[s][t]=a[s][t].filter(r=>r!==i),a})},A=async()=>{g(!0);const{error:s}=await _("permissions_config",JSON.stringify(m));j(s?{title:"Erreur",description:"Impossible de sauvegarder les permissions.",variant:"destructive"}:{title:"Succès",description:"Permissions sauvegardées."}),g(!1)};return y||o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(N,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsx(k,{pageTitle:"Gestion des Permissions",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(D,{children:e.jsx("title",{children:"Gestion des Permissions"})}),e.jsxs(I.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(O,{className:"w-10 h-10 text-primary"}),"Gestion des Permissions Détaillées"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Définissez qui peut créer ou modifier chaque type de contenu."})]}),e.jsxs($,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Tableau des Permissions"}),e.jsx(H,{children:"Cochez les cases pour accorder les droits de création ou de modification à un rôle pour une ressource donnée."})]}),e.jsx(G,{children:e.jsxs(q,{children:[e.jsxs(J,{children:[e.jsxs(h,{children:[e.jsx(l,{children:"Ressource"}),p.map(s=>e.jsx(l,{colSpan:2,className:"text-center capitalize",children:s},s))]}),e.jsxs(h,{children:[e.jsx(l,{}),p.map(s=>e.jsxs(v.Fragment,{children:[e.jsx(l,{className:"text-center",children:"Créer"}),e.jsx(l,{className:"text-center",children:"Modifier"})]},s))]})]}),e.jsx(L,{children:W.map(s=>{s.id;const t=s.id==="news_advanced";return e.jsxs(h,{children:[e.jsxs(u,{className:"font-medium",children:[s.label,t&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Supprimer, Archiver, Voir news non publiées"})]}),p.map(i=>e.jsx(v.Fragment,{children:t?e.jsx(u,{colSpan:2,className:"text-center",children:e.jsx("div",{className:"flex flex-col gap-1 items-center",children:w.map(n=>{var c,a;return e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx(S,{checked:((a=(c=m[i])==null?void 0:c[s.id])==null?void 0:a.includes(n))||!1,onCheckedChange:r=>C(i,s.id,n,r),disabled:i==="admin"}),e.jsx("span",{className:"capitalize",children:n==="delete"?"Supprimer":n==="archive"?"Archiver":"Voir non publiées"})]},n)})})}):e.jsx(e.Fragment,{children:P.map(n=>{var c,a;return e.jsx(u,{className:"text-center",children:e.jsx(S,{checked:((a=(c=m[i])==null?void 0:c[s.id])==null?void 0:a.includes(n))||!1,onCheckedChange:r=>C(i,s.id,n,r),disabled:i==="admin"})},`${s.id}-${i}-${n}`)})})},`${s.id}-${i}`))]},s.id)})})]})}),e.jsx(M,{children:e.jsxs(V,{onClick:A,disabled:b,children:[b?e.jsx(N,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(B,{className:"w-4 h-4 mr-2"}),"Sauvegarder les Permissions"]})})]})]})})};export{X as default};
