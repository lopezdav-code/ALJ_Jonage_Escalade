import{r as u,O as _,j as e,R as B,U as H,m as f,B as I,a1 as L,C as x,b as m,d as h,a2 as A,e as p,F as M,G as k,H as N,J as i,K as F,M as r,x as c,t as b}from"./index-1760370975611.js";const U=()=>{const[l,g]=u.useState([]),[v,d]=u.useState(!0),{toast:j}=_();u.useEffect(()=>{(async()=>{d(!0);const{data:t,error:n}=await b.from("competitions").select("id, name, location, start_date, disciplines").order("start_date",{ascending:!1});if(n){j({title:"Erreur",description:"Impossible de charger les compétitions.",variant:"destructive"}),d(!1);return}const{data:w,error:T}=await b.from("competition_participants").select("competition_id, role");if(T){j({title:"Erreur",description:"Impossible de charger les participants.",variant:"destructive"}),d(!1);return}const D=t.map(y=>{const o=w.filter(a=>a.competition_id===y.id),E=o.filter(a=>a.role==="Coach").length,R=o.filter(a=>a.role==="Arbitre").length,S=o.filter(a=>a.role==="Competiteur").length;return{...y,coaches:E,arbitres:R,competiteurs:S,total:o.length}});g(D),d(!1)})()},[j]);const C=({discipline:s})=>{const t=s.toLowerCase().replace(/ /g,"");let n="default";return t.includes("bloc")?n="bloc":t.includes("difficulté")?n="difficulte":t.includes("vitesse")&&(n="vitesse"),e.jsx(c,{variant:n,children:s})};return v?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(B,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs(H,{children:[e.jsx("title",{children:"Récapitulatif des Inscriptions - Club d'Escalade"}),e.jsx("meta",{name:"description",content:"Tableau récapitulatif des inscriptions aux compétitions d'escalade"})]}),e.jsxs(f.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"flex items-center gap-4",children:[e.jsxs(I,{variant:"ghost",onClick:()=>window.history.back(),className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold headline",children:"Récapitulatif des Inscriptions"}),e.jsx("p",{className:"text-xl text-muted-foreground mt-2",children:"Vue d'ensemble des participants par compétition"})]})]}),e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),"Tableau des Inscriptions"]})}),e.jsx(p,{children:e.jsxs(M,{children:[e.jsx(k,{children:e.jsxs(N,{children:[e.jsx(i,{children:"Compétition"}),e.jsx(i,{children:"Date"}),e.jsx(i,{children:"Discipline"}),e.jsx(i,{className:"text-center",children:"Coachs"}),e.jsx(i,{className:"text-center",children:"Arbitres"}),e.jsx(i,{className:"text-center",children:"Compétiteurs"}),e.jsx(i,{className:"text-center",children:"Total"})]})}),e.jsx(F,{children:l.map(s=>e.jsxs(N,{children:[e.jsx(r,{className:"font-medium",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.location})]})}),e.jsx(r,{children:new Date(s.start_date).toLocaleDateString("fr-FR")}),e.jsx(r,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.disciplines.map(t=>e.jsx(C,{discipline:t},t))})}),e.jsx(r,{className:"text-center",children:e.jsx(c,{variant:"secondary",children:s.coaches})}),e.jsx(r,{className:"text-center",children:e.jsx(c,{variant:"secondary",children:s.arbitres})}),e.jsx(r,{className:"text-center",children:e.jsx(c,{variant:"default",children:s.competiteurs})}),e.jsx(r,{className:"text-center",children:e.jsx(c,{variant:"outline",className:"font-bold",children:s.total})})]},s.id))})]})})]})}),e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(x,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(h,{className:"text-lg",children:"Total Participants"})}),e.jsx(p,{children:e.jsx("div",{className:"text-3xl font-bold text-primary",children:l.reduce((s,t)=>s+t.total,0)})})]}),e.jsxs(x,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(h,{className:"text-lg",children:"Compétitions"})}),e.jsx(p,{children:e.jsx("div",{className:"text-3xl font-bold text-primary",children:l.length})})]}),e.jsxs(x,{children:[e.jsx(m,{className:"pb-3",children:e.jsx(h,{className:"text-lg",children:"Moyenne par Compétition"})}),e.jsx(p,{children:e.jsx("div",{className:"text-3xl font-bold text-primary",children:l.length>0?Math.round(l.reduce((s,t)=>s+t.total,0)/l.length):0})})]})]})]})};export{U as default};
