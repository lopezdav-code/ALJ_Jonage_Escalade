import{Q as E,af as w,j as e,R as L,U as k,m,ag as I,O as S,r as l,C as A,b as R,d as F,Z as P,e as M,a as B,I as $,f as D,B as H,t as N}from"./index-1760370975611.js";import{U as K}from"./upload-1760370975611.js";const p=({title:n,description:c,configKey:a,currentImageUrl:i})=>{const{updateConfig:d}=w(),{toast:s}=S(),[f,x]=l.useState(!1),[o,u]=l.useState(null),[h,g]=l.useState(null);l.useEffect(()=>{g(i)},[i]);const _=t=>{if(t.target.files&&t.target.files[0]){const r=t.target.files[0];u(r),g(URL.createObjectURL(r))}},C=async()=>{if(o){x(!0);try{const t=o.name.split(".").pop(),r=`${a}-${Date.now()}.${t}`,j="site_assets",{error:y}=await N.storage.from(j).upload(r,o,{cacheControl:"3600",upsert:!1});if(y)throw y;const{data:v}=N.storage.from(j).getPublicUrl(r),U=v.publicUrl,{error:b}=await d(a,U);if(b)throw b;s({title:"Succès",description:"L'image a été mise à jour."}),u(null)}catch(t){s({title:"Erreur",description:t.message,variant:"destructive"}),g(i)}finally{x(!1)}}};return e.jsxs(A,{children:[e.jsxs(R,{children:[e.jsx(F,{children:n}),e.jsx(P,{children:c})]}),e.jsxs(M,{className:"flex flex-col items-center gap-4",children:[h?e.jsx("img",{src:h,alt:n,className:"max-h-32 object-contain border p-2 rounded-md bg-muted/20"}):e.jsx("div",{className:"h-24 w-full flex items-center justify-center bg-muted/20 rounded-md border border-dashed",children:e.jsx(B,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx($,{type:"file",accept:"image/*",onChange:_})]}),e.jsx(D,{children:e.jsxs(H,{onClick:C,disabled:f||!o,className:"w-full",children:[f?e.jsx(L,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(K,{className:"w-4 h-4 mr-2"}),"Enregistrer"]})})]})},z=()=>{const{isAdmin:n,loading:c}=E(),{config:a,loadingConfig:i}=w(),d=[{title:"Logo Partenaire: Métropole de Lyon",description:"Logo affiché dans le pied de page.",key:"partner_logo_metropole_lyon"},{title:"Logo Partenaire: FFME",description:"Logo affiché dans le pied de page.",key:"partner_logo_ffme"},{title:"Logo Partenaire: Région AURA",description:"Logo affiché dans le pied de page.",key:"partner_logo_auvergne_rhone_alpes"},{title:"Logo Partenaire: Mairie de Jonage",description:"Logo affiché dans le pied de page.",key:"partner_logo_mairie_jonage"}];return c||i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(L,{className:"w-12 h-12 animate-spin text-primary"})}):n?e.jsxs("div",{className:"space-y-8",children:[e.jsx(k,{children:e.jsx("title",{children:"Réglages du site - Admin"})}),e.jsxs(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(I,{className:"w-10 h-10 text-primary"}),"Réglages du site"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Modifiez les éléments globaux du site ici."})]}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Images principales"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(p,{title:"Logo du Site",description:"Le logo principal affiché dans l'en-tête.",configKey:"site_logo",currentImageUrl:a.site_logo}),e.jsx(p,{title:"Bannière des Actualités",description:"L'image affichée en haut de la page Actualités.",configKey:"news_banner_image",currentImageUrl:a.news_banner_image})]})]}),e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Logos des partenaires"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:d.map(s=>e.jsx(p,{title:s.title,description:s.description,configKey:s.key,currentImageUrl:a[s.key]},s.key))})]})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Accès non autorisé"}),e.jsx("p",{className:"text-muted-foreground",children:"Cette page est réservée aux administrateurs."})]})};export{z as default};
