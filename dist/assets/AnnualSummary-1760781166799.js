import{Y,r as h,w as se,l as ae,ay as ie,y as re,j as e,z as ne,af as ce,H as le,D as v,m as oe,a9 as de,an as ue,ao as me,ap as w,aq as C,az as L,aA as xe,G as T,J as S,K as z,W as D,o as R,p as U,q as g,s as p,B as _,t as A,v as f,aB as E}from"./index-1760781166799.js";import{C as Q}from"./check-circle-2-1760781166799.js";const he=Y("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),pe=Y("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),X={Bloc:"bloc",Difficulté:"difficulte",Vitesse:"vitesse"},$=({title:d,competitors:u,competitions:i})=>i.length===0?null:e.jsxs(T,{children:[e.jsx(S,{children:e.jsx(z,{children:d})}),e.jsx(D,{className:"overflow-x-auto",children:u.length>0?e.jsxs(R,{children:[e.jsx(U,{children:e.jsxs(g,{children:[e.jsx(p,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Compétiteur"}),i.map(t=>e.jsx(p,{className:"text-center min-w-[150px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:t.short_title||t.name}),e.jsx("div",{className:"text-xs text-muted-foreground font-normal",children:new Date(t.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[t.disciplines.map(s=>e.jsx(_,{variant:X[s]||"default",children:s.slice(0,4)},s)),t.nature&&e.jsx(_,{variant:"outline",children:t.nature})]})]})},t.id))]})}),e.jsx(A,{children:u.map(({member:t,participations:s})=>e.jsxs(g,{children:[e.jsx(f,{className:"font-medium sticky left-0 bg-background z-10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:`w-4 h-4 ${t.sexe==="H"?"text-blue-600":"text-pink-600"}`}),e.jsx("span",{className:t.sexe==="H"?"text-blue-600":"text-pink-600",children:E(t.first_name,t.last_name,!0)}),t.category&&e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",t.category,")"]})]})}),i.map(n=>e.jsx(f,{className:"text-center",children:s[n.id]?s[n.id].ranking?e.jsxs("div",{className:"flex items-center justify-center gap-1 font-bold text-primary",children:[e.jsx(pe,{className:"w-4 h-4"}),s[n.id].ranking]}):e.jsx(Q,{className:"w-5 h-5 text-green-500 mx-auto"}):null},n.id))]},t.id))})]}):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Aucun compétiteur dans ce groupe."})})]}),K=({title:d,competitors:u,competitions:i})=>i.length===0||u.length===0?null:e.jsxs(T,{children:[e.jsx(S,{children:e.jsx(z,{children:d})}),e.jsx(D,{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(U,{children:e.jsxs(g,{children:[e.jsx(p,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Compétiteur"}),i.map(t=>e.jsx(p,{className:"text-center min-w-[150px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:t.short_title||t.name}),e.jsx("div",{className:"text-xs text-muted-foreground font-normal",children:new Date(t.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[t.disciplines.map(s=>e.jsx(_,{variant:X[s]||"default",children:s.slice(0,4)},s)),t.nature&&e.jsx(_,{variant:"outline",children:t.nature})]})]})},t.id)),e.jsx(p,{className:"text-right font-bold sticky right-0 bg-background z-10 min-w-[100px]",children:"Total"})]})}),e.jsx(A,{children:u.map(({member:t,participations:s})=>{let n=0;return i.forEach(c=>{s[c.id]&&c.prix>0&&(n+=c.prix)}),n===0?null:e.jsxs(g,{children:[e.jsx(f,{className:"font-medium sticky left-0 bg-background z-10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:`w-4 h-4 ${t.sexe==="H"?"text-blue-600":"text-pink-600"}`}),e.jsx("span",{className:t.sexe==="H"?"text-blue-600":"text-pink-600",children:E(t.first_name,t.last_name,!0)}),t.category&&e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",t.category,")"]})]})}),i.map(c=>e.jsx(f,{className:"text-center",children:s[c.id]&&c.prix>0?c.prix.toLocaleString("fr-FR",{style:"currency",currency:"EUR"}):""},c.id)),e.jsx(f,{className:"text-right font-bold sticky right-0 bg-background z-10 text-primary",children:n.toLocaleString("fr-FR",{style:"currency",currency:"EUR"})})]},t.id)})})]})})]}),W=({title:d,volunteers:u,competitions:i,icon:t})=>i.length===0||u.length===0?null:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[t&&e.jsx(t,{className:"w-6 h-6"}),d]})}),e.jsx(D,{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(U,{children:e.jsxs(g,{children:[e.jsx(p,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Bénévole"}),i.map(s=>e.jsx(p,{className:"text-center min-w-[150px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:s.short_title||s.name}),e.jsx("div",{className:"text-xs text-muted-foreground font-normal",children:new Date(s.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})})]})},s.id)),e.jsx(p,{className:"text-right font-bold sticky right-0 bg-background z-10 min-w-[100px]",children:"Total"})]})}),e.jsx(A,{children:u.map(({member:s,participations:n})=>{const c=Object.keys(n).length;return c===0?null:e.jsxs(g,{children:[e.jsx(f,{className:"font-medium sticky left-0 bg-background z-10",children:E(s.first_name,s.last_name,!0)}),i.map(y=>e.jsx(f,{className:"text-center",children:n[y.id]&&e.jsx(Q,{className:"w-5 h-5 text-green-500 mx-auto"})},y.id)),e.jsx(f,{className:"text-right font-bold sticky right-0 bg-background z-10 text-primary",children:c})]},s.id)})})]})})]}),ge=()=>{const[d,u]=h.useState({u11_u15:[],u15_u19:[]}),[i,t]=h.useState({coaches:[],referees:[]}),[s,n]=h.useState({u11_u15:[],u15_u19:[],all:[]}),[c,y]=h.useState(!0),{toast:M}=se(),Z=ae(),B=ie(),[ee,F]=h.useState("participation");h.useEffect(()=>{const N=new URLSearchParams(B.search).get("tab");N&&F(N)},[B.search]);const H=h.useCallback(async()=>{y(!0);try{const{data:b,error:N}=await re.from("competition_participants").select(`
          role,
          member_id,
          competition_id,
          ranking,
          members ( id, first_name, last_name, title, category, sexe ),
          competitions ( id, name, short_title, start_date, disciplines, nature, prix )
        `);if(N)throw N;const te=b.map(m=>m.competitions).filter((m,l,r)=>m&&r.findIndex(x=>x.id===m.id)===l).sort((m,l)=>new Date(m.start_date)-new Date(l.start_date)),I=m=>{const l={},r={};b.filter(a=>{var o;return a.role==="Competiteur"&&((o=a.members)==null?void 0:o.title)===m}).forEach(a=>{if(!a.members||!a.competitions)return;const o=a.members.id,j=a.competitions.id;l[o]||(l[o]={member:a.members,participations:{}}),l[o].participations[j]={ranking:a.ranking},r[j]||(r[j]=a.competitions)});const x=Object.values(l).sort((a,o)=>{const j=a.member.category||"",V=o.member.category||"";if(j<V)return-1;if(j>V)return 1;const P=a.member.sexe||"",J=o.member.sexe||"";return P<J?-1:P>J?1:a.member.first_name.localeCompare(o.member.first_name)}),k=Object.values(r).sort((a,o)=>new Date(a.start_date)-new Date(o.start_date));return{members:x,competitions:k}},q=m=>{const l={};return b.filter(r=>r.role===m).forEach(r=>{if(!r.members||!r.competitions)return;const x=r.members.id,k=r.competitions.id;l[x]||(l[x]={member:r.members,participations:{}}),l[x].participations[k]=!0}),Object.values(l).sort((r,x)=>r.member.first_name.localeCompare(x.member.first_name))},G=I("Compétition U11-U15"),O=I("Compétition U15-U19");u({u11_u15:G.members,u15_u19:O.members}),n({u11_u15:G.competitions,u15_u19:O.competitions,all:te}),t({coaches:q("Coach"),referees:q("Arbitre")})}catch{M({title:"Erreur",description:"Impossible de charger les données du récapitulatif.",variant:"destructive"})}finally{y(!1)}},[M]);return h.useEffect(()=>{H()},[H]),c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ne,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsx(ce,{requireAdherent:!0,pageTitle:"Récapitulatif annuel",message:"Le récapitulatif annuel est réservé aux adhérents du club. Veuillez vous connecter avec un compte adhérent pour y accéder.",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs(le,{children:[e.jsx("title",{children:"Récapitulatif Annuel et Financier - ALJ Escalade Jonage"}),e.jsx("meta",{name:"description",content:"Récapitulatif annuel des participations aux compétitions et suivi financier."})]}),e.jsx(v.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(oe,{variant:"ghost",size:"icon",onClick:()=>Z("/competitions"),children:e.jsx(de,{})}),e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(he,{className:"w-10 h-10 text-primary"}),"Récapitulatif Annuel et Financier"]})]})}),e.jsxs(ue,{value:ee,onValueChange:F,children:[e.jsxs(me,{children:[e.jsx(w,{value:"participation",children:"Liste des compétitions"}),e.jsx(w,{value:"financial",children:"Récapitulatif Financier"}),e.jsx(w,{value:"volunteers",children:"Participation des adhérents"})]}),e.jsx(C,{value:"participation",className:"pt-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-8",children:[e.jsx($,{title:"Groupe U11-U15",competitors:d.u11_u15,competitions:s.u11_u15}),e.jsx($,{title:"Groupe U15-U19",competitors:d.u15_u19,competitions:s.u15_u19})]})}),e.jsx(C,{value:"financial",className:"pt-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-8",children:[e.jsx(K,{title:"Groupe U11-U15",competitors:d.u11_u15,competitions:s.u11_u15}),e.jsx(K,{title:"Groupe U15-U19",competitors:d.u15_u19,competitions:s.u15_u19})]})}),e.jsx(C,{value:"volunteers",className:"pt-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-8",children:[e.jsx(W,{title:"Coachs",volunteers:i.coaches,competitions:s.all,icon:L}),e.jsx(W,{title:"Arbitres",volunteers:i.referees,competitions:s.all,icon:xe})]})})]})]})})};export{ge as default};
