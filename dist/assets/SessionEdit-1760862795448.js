import{Y as te,r as c,l as se,j as e,G as ae,m as k,X as ie,I,Z as le,R as ce,D as Q,J as oe,K as de,W as ue,M as A,N as P,O as R,Q as V,U as H,V as q,_ as Y,F as me,$ as he,a0 as pe,a1 as ge,a2 as xe,a3 as fe,a4 as _e,a5 as je,S as ye,y,a6 as ve,a7 as Se,w as be,x as Ne,z as we,A as Ce,H as Ee,E as Ie}from"./index-1760862795448.js";import{B as $e}from"./book-marked-1760862795448.js";import{L as Fe}from"./library-1760862795448.js";import{U as ke}from"./upload-1760862795448.js";import{S as Te}from"./save-1760862795448.js";const Ae=te("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),De=te("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Me=({exercise:s,index:d,total:v,onExerciseChange:S,onRemove:h,onMove:$,onImport:b})=>{const[_,u]=c.useState(null),[N,f]=c.useState(s.image_url||null),w=se();c.useEffect(()=>{f(s.image_url),s.image_url&&_&&s.image_url!==URL.createObjectURL(_)&&u(null)},[s.image_url]);const i=(o,E)=>{S(d,{...s,[o]:E})},m=o=>{const E=o.target.files[0];if(E){u(E);const M=URL.createObjectURL(E);f(M),S(d,{...s,newImageFile:E,image_url:M})}},C=()=>{s.pedagogy_sheet_id&&w(`/pedagogy#sheet-${s.pedagogy_sheet_id}`)};return e.jsxs(ae,{className:"p-4 relative bg-muted/40",children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx(k,{type:"button",variant:"ghost",size:"icon",onClick:()=>$(d,-1),disabled:d===0,children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",onClick:()=>$(d,1),disabled:d===v-1,children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(k,{type:"button",variant:"ghost",size:"icon",onClick:()=>h(d),children:e.jsx(ie,{className:"w-4 h-4 text-destructive"})})]}),e.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-2",children:[e.jsxs(k,{type:"button",variant:"outline",size:"sm",onClick:b,children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Importer"]}),s.pedagogy_sheet_id&&e.jsxs(k,{type:"button",variant:"secondary",size:"sm",onClick:C,title:"Voir la fiche pédagogique",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Fiche"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-12",children:[e.jsx(I,{placeholder:"Objectifs opérationnels",value:s.operational_objective||"",onChange:o=>i("operational_objective",o.target.value)}),e.jsx(I,{placeholder:"Situation",value:s.situation||"",onChange:o=>i("situation",o.target.value)}),e.jsx(I,{placeholder:"Organisation Temps/volume",value:s.organisation||"",onChange:o=>i("organisation",o.target.value)}),e.jsx(I,{placeholder:"Consigne",value:s.consigne||"",onChange:o=>i("consigne",o.target.value)}),e.jsx(I,{placeholder:"Temps (ex: 10min)",value:s.time||"",onChange:o=>i("time",o.target.value)}),e.jsx(I,{placeholder:"Critère de réussite",value:s.success_criteria||"",onChange:o=>i("success_criteria",o.target.value)}),e.jsx(I,{placeholder:"Régulation",value:s.regulation||"",onChange:o=>i("regulation",o.target.value)}),e.jsx(I,{placeholder:"Lien support",value:s.support_link||"",onChange:o=>i("support_link",o.target.value)}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 border rounded-md flex items-center justify-center bg-background",children:N?e.jsx("img",{src:N,alt:"Aperçu",className:"w-full h-full object-cover rounded-md"}):e.jsx(le,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{htmlFor:`image-upload-${d}`,children:e.jsx(k,{type:"button",variant:"outline",size:"sm",asChild:!0,className:"cursor-pointer",children:e.jsxs("span",{children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),_?"Changer l'image":"Téléverser une image"]})})}),e.jsx(I,{id:`image-upload-${d}`,type:"file",className:"hidden",accept:"image/*",onChange:m}),s.image_url&&!_&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Image actuelle. Téléversez pour remplacer."})]})]})]})]})},Oe={all:"Toutes les fiches",educational_game:"Jeu éducatif",warm_up_exercise:"Exercice d'échauffement",strength_exercise:"Exercice de renfo",review_sheet:"Fiche de révision"},Z=({title:s,options:d,selected:v,onChange:S,onToggleFilter:h,isFiltered:$,canFilter:b})=>{const _=v||[],u=d||[],N=()=>{_.length===u.length?S([]):S(u)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx(A,{children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&e.jsx(k,{type:"button",variant:$?"default":"outline",size:"sm",onClick:h,className:"text-xs h-7 px-2",children:$?"Tous":"Filtrer pour ce cours"}),e.jsx(k,{type:"button",variant:"link",size:"sm",onClick:N,className:"p-0 h-auto text-xs",children:_.length===u.length?"Désél.":"Tout"})]})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto rounded-md border p-2 space-y-2",children:u.map((f,w)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{id:`${s}-${f}-${w}`,checked:_.includes(f),onCheckedChange:i=>{const m=i?[..._,f]:_.filter(C=>C!==f);S(m)}}),e.jsx("label",{htmlFor:`${s}-${f}-${w}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:f})]},`${s}-${f}-${w}`))})]})},qe=({onSelect:s,onCancel:d})=>{const[v,S]=c.useState([]),[h,$]=c.useState(""),[b,_]=c.useState("all"),[u,N]=c.useState("all");c.useEffect(()=>{(async()=>{const{data:m}=await y.from("pedagogy_sheets").select("*").order("title");S(m||[])})()},[]);const f=c.useMemo(()=>{const i=v.filter(m=>m.sheet_type==="educational_game"&&m.theme).map(m=>m.theme);return["all",...Array.from(new Set(i))]},[v]),w=v.filter(i=>{const m=i.title.toLowerCase().includes(h.toLowerCase()),C=b==="all"||i.sheet_type===b,o=u==="all"||i.theme===u;return m&&C&&o});return e.jsx(ge,{open:!0,onOpenChange:d,children:e.jsxs(xe,{className:"sm:max-w-[725px]",children:[e.jsxs(fe,{children:[e.jsx(_e,{children:"Importer depuis une Fiche Pédagogique"}),e.jsx(je,{children:"Sélectionnez une fiche pour remplir automatiquement l'exercice."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-4",children:[e.jsxs("div",{className:"relative md:col-span-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(I,{placeholder:"Rechercher une fiche...",className:"pl-10",value:h,onChange:i=>$(i.target.value)})]}),e.jsxs(P,{value:b,onValueChange:_,children:[e.jsx(R,{children:e.jsx(V,{placeholder:"Filtrer par type"})}),e.jsx(H,{children:Object.entries(Oe).map(([i,m])=>e.jsx(q,{value:i,children:m},i))})]}),e.jsxs(P,{value:u,onValueChange:N,disabled:f.length<=1,children:[e.jsx(R,{children:e.jsx(V,{placeholder:"Filtrer par thème"})}),e.jsx(H,{children:f.map(i=>e.jsx(q,{value:i,children:i==="all"?"Tous les thèmes":i},i))})]})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto space-y-2 mt-4 pr-2",children:w.map(i=>e.jsxs("div",{className:"p-3 border rounded-md hover:bg-accent cursor-pointer",onClick:()=>s(i),children:[e.jsx("p",{className:"font-semibold",children:i.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:i.description||i.game_goal})]},i.id))})]})})},Le=({session:s,onSave:d,onCancel:v,isSaving:S})=>{const[h,$]=c.useState([]),[b,_]=c.useState([]),[u,N]=c.useState([]),[f,w]=c.useState(!1),[i,m]=c.useState(null),[C,o]=c.useState(!1),E=ce.useRef(null);c.useEffect(()=>{(async()=>{try{const{data:a,error:r}=await y.from("secure_members").select("id, first_name, last_name, title").order("last_name").order("first_name");if(r)throw r;$(a||[]);const{data:l,error:x}=await y.from("cycles").select("id, name, short_description").order("name");if(x)throw x;_(l||[]);const{data:T,error:F}=await y.from("schedules").select(`
            id,
            type,
            age_category,
            day,
            start_time,
            end_time,
            instructor_1:instructor_1_id(id, first_name, last_name),
            instructor_2:instructor_2_id(id, first_name, last_name),
            instructor_3:instructor_3_id(id, first_name, last_name),
            instructor_4:instructor_4_id(id, first_name, last_name)
          `).order("day, start_time");if(F){const{data:re,error:ne}=await y.from("schedules").select("id, type, age_category, day, start_time, end_time").order("day, start_time");ne||N(re||[])}else N(T||[])}catch(a){console.error("Error fetching data for SessionForm:",a)}})()},[]),c.useMemo(()=>h.reduce((t,a)=>(t[a.id]={fullName:`${a.first_name} ${a.last_name}`,firstName:a.first_name,lastName:a.last_name,title:a.title},t),{}),[h]);const M=h.map(t=>`${t.first_name} ${t.last_name}`),j=c.useMemo(()=>{const t=h.filter(a=>a.title==="Loisir lycée").map(a=>`${a.first_name} ${a.last_name}`);return Array.from(new Set(t))},[h]),[n,p]=c.useState(()=>s?{...s,date:s.date||"",start_time:s.start_time||"18:30",instructors:[],students:[],cycle_id:s.cycle_id||null,schedule_id:s.schedule_id||null,session_objective:s.session_objective||"",equipment:s.equipment||"",comment:s.comment||"",exercises:s.exercises||[]}:{date:"",start_time:"18:30",instructors:[],students:[],absent_students:[],cycle_id:null,schedule_id:null,session_objective:"",equipment:"",comment:"",exercises:[]});c.useEffect(()=>{if(s&&h.length>0&&n.instructors.length===0){const t=(s.instructors||[]).map(r=>{const l=h.find(x=>x.id===r);return l?`${l.first_name} ${l.last_name}`:null}).filter(Boolean),a=(s.students||[]).map(r=>{const l=h.find(x=>x.id===r);return l?`${l.first_name} ${l.last_name}`:null}).filter(Boolean);(s.absent_students||[]).map(r=>{const l=h.find(x=>x.id===r);return l?`${l.first_name} ${l.last_name}`:null}).filter(Boolean),p(r=>({...r,instructors:t,students:a}))}},[s,h,n.instructors.length]);const g=c.useMemo(()=>{if(!n.schedule_id||u.length===0)return[];const t=u.find(r=>String(r.id)===String(n.schedule_id));if(!t)return[];const a=[t.instructor_1,t.instructor_2,t.instructor_3,t.instructor_4].filter(Boolean).map(r=>`${r.first_name} ${r.last_name}`);return Array.from(new Set(a))},[n.schedule_id,u]),D=c.useMemo(()=>{if(C&&n.schedule_id&&g.length>0){const t=[...g,...n.instructors||[]];return Array.from(new Set(t))}return Array.from(new Set(M))},[M,C,n.schedule_id,g,n.instructors]),O=c.useMemo(()=>{const t=n.students||[];return j.filter(a=>!t.includes(a))},[j,n.students]);c.useEffect(()=>{s!=null&&s.schedule_id&&E.current===null&&(E.current=s.schedule_id)},[s]),c.useEffect(()=>{if(String(n.schedule_id)!==String(E.current))if(E.current=n.schedule_id,n.schedule_id){const t=u.find(a=>String(a.id)===String(n.schedule_id));t&&p(a=>({...a,instructors:g.length>0?g:a.instructors,start_time:t.start_time||a.start_time}))}else p(t=>({...t,instructors:[]}))},[n.schedule_id,g,u]);const L=t=>{const{name:a,value:r}=t.target;p(l=>({...l,[a]:r}))},J=(t,a)=>{p(r=>({...r,[t]:a}))},W=(t,a)=>{const r=[...n.exercises];r[t]=a,p(l=>({...l,exercises:r}))},X=()=>{p(t=>({...t,exercises:[...t.exercises,{id:`new-${Date.now()}`,operational_objective:"",situation:"",organisation:"",consigne:"",time:"",success_criteria:"",regulation:"",support_link:"",image_url:"",newImageFile:null,pedagogy_sheet_id:null}]}))},G=t=>{const a=n.exercises.filter((r,l)=>l!==t);p(r=>({...r,exercises:a}))},B=(t,a)=>{const r=[...n.exercises],l=t+a;l<0||l>=r.length||([r[t],r[l]]=[r[l],r[t]],p(x=>({...x,exercises:r})))},U=t=>{m(t),w(!0)},K=t=>{const a=[...n.exercises],r=a[i];r.pedagogy_sheet_id=t.id,t.sheet_type==="educational_game"?(r.operational_objective=`Jeu: ${t.title}`,r.situation=t.starting_situation,r.consigne=`But: ${t.game_goal}. Évolution: ${t.evolution}`,r.image_url=t.url,r.support_link=""):(r.operational_objective=t.title,r.situation=t.description,r.consigne="",t.type==="image_file"?(r.image_url=t.url,r.support_link=""):(r.support_link=t.url,r.image_url=t.thumbnail_url||"")),p(l=>({...l,exercises:a})),w(!1),m(null)},z=t=>{t.preventDefault();const a=n.instructors.map(x=>{var T;return(T=h.find(F=>`${F.first_name} ${F.last_name}`===x))==null?void 0:T.id}).filter(Boolean),r=n.students.map(x=>{var T;return(T=h.find(F=>`${F.first_name} ${F.last_name}`===x))==null?void 0:T.id}).filter(Boolean),l={...n,date:n.date||null,start_time:n.start_time||null,instructors:a,students:r};d(l)};return e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(ae,{children:e.jsxs("form",{onSubmit:z,children:[e.jsx(oe,{children:e.jsx(de,{children:s?"Modifier la séance":"Ajouter une nouvelle séance"})}),e.jsxs(ue,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"schedule_id",children:"Emploi du temps associé"}),e.jsxs(P,{value:n.schedule_id?n.schedule_id.toString():"",onValueChange:t=>p(a=>({...a,schedule_id:t||null})),children:[e.jsx(R,{id:"schedule_id",children:e.jsx(V,{placeholder:"Sélectionner un emploi du temps (optionnel)"})}),e.jsxs(H,{children:[e.jsx(q,{value:"",children:"Aucun emploi du temps"}),u.length===0?e.jsx(q,{value:"none",disabled:!0,children:"Aucun emploi du temps disponible"}):u.map(t=>e.jsxs(q,{value:t.id.toString(),children:[t.type," / ",t.age_category," / ",t.day," / ",t.start_time]},t.id))]})]}),n.schedule_id&&(s==null?void 0:s.schedule)&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Emploi du temps actuel: ",s.schedule.type," / ",s.schedule.age_category," / ",s.schedule.day," / ",s.schedule.start_time]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"date",children:"Date du cours (optionnel)"}),e.jsx(I,{id:"date",name:"date",type:"date",value:n.date,onChange:L})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"start_time",children:"Heure de début"}),e.jsx(I,{id:"start_time",name:"start_time",type:"time",value:n.start_time,onChange:L})]}),e.jsx(Z,{title:"Encadrants",options:D,selected:n.instructors,onChange:t=>J("instructors",t),onToggleFilter:()=>o(!C),isFiltered:C,canFilter:n.schedule_id&&g.length>0}),e.jsxs("div",{className:"space-y-4 md:col-span-1 lg:col-span-1",children:[e.jsx(Z,{title:"Élèves présents",options:j,selected:n.students,onChange:t=>J("students",t)}),e.jsxs("div",{children:[e.jsx(A,{children:"Élèves absents (calculés)"}),e.jsx("div",{className:"max-h-40 overflow-y-auto rounded-md border p-2 space-y-2 mt-2",children:O.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun élève absent"}):O.map((t,a)=>e.jsx("div",{className:"text-sm",children:t},`absent-${a}`))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Cette liste est calculée automatiquement (tous les lycéens moins les présents)."})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"cycle_id",children:"Cycle associé"}),e.jsxs(P,{value:n.cycle_id?n.cycle_id.toString():"",onValueChange:t=>p(a=>({...a,cycle_id:t||null})),children:[e.jsx(R,{id:"cycle_id",children:e.jsx(V,{placeholder:"Sélectionner un cycle (optionnel)"})}),e.jsxs(H,{children:[e.jsx(q,{value:"",children:"Aucun cycle"}),b.map(t=>e.jsxs(q,{value:t.id.toString(),children:[t.name,t.short_description&&` - ${t.short_description}`]},t.id))]})]}),n.cycle_id&&(s==null?void 0:s.cycles)&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Cycle actuel: ",s.cycles.name]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"session_objective",children:"Objectif de séance"}),e.jsx(Y,{id:"session_objective",name:"session_objective",value:n.session_objective,onChange:L})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"equipment",children:"Matériel"}),e.jsx(Y,{id:"equipment",name:"equipment",value:n.equipment,onChange:L})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"comment",children:"Commentaire"}),e.jsx(Y,{id:"comment",name:"comment",value:n.comment,onChange:L})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Déroulé de la séance"}),e.jsx("div",{className:"space-y-4",children:n.exercises.map((t,a)=>e.jsx(Me,{exercise:t,index:a,total:n.exercises.length,onExerciseChange:W,onRemove:G,onMove:B,onImport:()=>U(a)},t.id))}),e.jsxs(k,{type:"button",variant:"outline",className:"mt-4",onClick:X,children:[e.jsx(me,{className:"w-4 h-4 mr-2"})," Ajouter un exercice"]})]})]}),e.jsxs(he,{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"ghost",onClick:v,disabled:S,children:"Annuler"}),e.jsx(k,{type:"submit",disabled:S,children:S?"Sauvegarde...":e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 mr-2"})," Sauvegarder"]})})]})]})}),f&&e.jsx(qe,{onSelect:K,onCancel:()=>w(!1)})]})},ee="exercise_images",Ve=()=>{const{id:s}=ve(),d=se(),[v]=Se(),[S,h]=c.useState(null),[$,b]=c.useState(!0),[_,u]=c.useState(!1),{toast:N}=be(),{user:f,isAdmin:w,loading:i}=Ne(),m=!i&&w,C=c.useCallback(async()=>{if(!s){b(!1);return}b(!0);const{data:j,error:n}=await y.from("sessions").select(`
        *,
        exercises (
          id,
          operational_objective,
          situation,
          organisation,
          consigne,
          time,
          success_criteria,
          regulation,
          support_link,
          image_url,
          pedagogy_sheet_id,
          order
        ),
        cycles (
          id,
          name,
          short_description
        )
      `).eq("id",s).single();if(n)N({title:"Erreur",description:"Impossible de charger la séance.",variant:"destructive"}),d("/session-log");else{let p=null;if(j.schedule_id)try{const{data:g,error:D}=await y.from("schedules").select("id, type, age_category, day, start_time, end_time").eq("id",j.schedule_id).single();!D&&g&&(p=g)}catch{}h({...j,schedule:p,start_time:j.start_time?j.start_time.substring(0,5):"18:30"})}b(!1)},[s,N,d]);c.useEffect(()=>{m?C():i||b(!1)},[C,m,i]);const o=async j=>{const n=j.name.split(".").pop(),g=`${`${Math.random()}.${n}`}`;let{error:D}=await y.storage.from(ee).upload(g,j);if(D)throw D;const{data:O}=y.storage.from(ee).getPublicUrl(g);return O.publicUrl},E=async j=>{if(m){u(!0);try{const{id:n,exercises:p,studentComments:g,...D}=j,O=await Promise.all(p.map(async t=>{let a=t.image_url;t.newImageFile&&(a=await o(t.newImageFile));const{newImageFile:r,...l}=t;return{...l,image_url:a}})),{cycles:L,schedule:J,instructorNames:W,studentNames:X,...G}=D,B=Object.entries(G).reduce((t,[a,r])=>(t[a]=r===""?null:r,t),{});let U=s;if(s){const{data:t,error:a}=await y.from("sessions").update(B).eq("id",s).select().single();if(a)throw a;await y.from("exercises").delete().eq("session_id",t.id);const r=O.map((l,x)=>{const{id:T,...F}=l;return{...F,session_id:t.id,order:x}});if(r.length>0){const{error:l}=await y.from("exercises").insert(r);if(l)throw l}U=t.id}else{const{data:t,error:a}=await y.from("sessions").insert(B).select().single();if(a)throw a;const r=O.map((l,x)=>{const{id:T,...F}=l;return{...F,session_id:t.id,order:x}});if(r.length>0){const{error:l}=await y.from("exercises").insert(r);if(l)throw l}U=t.id}if(g&&Object.keys(g).length>0){await y.from("student_session_comments").delete().eq("session_id",U);const t=Object.entries(g).filter(([a,r])=>r&&r.trim()!=="").map(([a,r])=>({session_id:U,member_id:a,comment:r.trim()}));if(t.length>0){const{error:a}=await y.from("student_session_comments").insert(t)}}N({title:"Séance sauvegardée !",description:"La séance a été enregistrée avec succès."});const K=v.get("from"),z=v.get("cycleId");d(K==="cycle"&&z?`/cycles/${z}`:"/session-log")}catch(n){N({title:"Erreur de sauvegarde",description:n.message,variant:"destructive"})}finally{u(!1)}}},M=()=>{const j=v.get("from"),n=v.get("cycleId");d(j==="cycle"&&n?`/cycles/${n}`:"/session-log")};return i||$?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(we,{className:"w-12 h-12 animate-spin text-primary"})}):m?e.jsxs("div",{className:"space-y-8",children:[e.jsxs(Ee,{children:[e.jsxs("title",{children:[s?"Modifier la séance":"Nouvelle séance"," - ALJ Escalade Jonage"]}),e.jsx("meta",{name:"description",content:"Édition d'une séance d'escalade du club."})]}),e.jsx(Q.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(Ie,{className:"w-10 h-10 text-primary"}),s?"Modifier la séance":"Nouvelle séance"]})}),e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsx(Le,{session:S,onSave:E,onCancel:M,isSaving:_})})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto text-muted-foreground"}),e.jsx("h1",{className:"text-2xl font-bold mt-4",children:"Accès restreint"}),e.jsx("p",{className:"text-muted-foreground",children:"Vous devez être un administrateur pour modifier les séances."}),!f&&e.jsx("p",{className:"mt-4",children:"Veuillez vous connecter."})]})};export{Ve as default};
