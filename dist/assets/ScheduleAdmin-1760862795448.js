import{l as b,w,x as C,r as u,y as p,j as e,z as T,H as A,D as g,m as c,a9 as E,aa as L,F as S,G as H,J as I,K as B,W as P,o as k,p as q,q as h,s as a,t as z,v as t,B as G,n as R,T as $}from"./index-1760862795448.js";const J=()=>{const n=b(),{toast:l}=w(),{isAdmin:i,loading:d}=C(),[o,f]=u.useState([]),[y,m]=u.useState(!0);u.useEffect(()=>{if(!d&&!i){n("/schedule");return}i&&x()},[i,d,n]);const x=async()=>{m(!0);try{const{data:s,error:r}=await p.from("schedules").select(`
          *,
          instructor_1:instructor_1_id(id, first_name, last_name),
          instructor_2:instructor_2_id(id, first_name, last_name),
          instructor_3:instructor_3_id(id, first_name, last_name),
          instructor_4:instructor_4_id(id, first_name, last_name)
        `).order("day").order("start_time");if(r)throw r;f(s||[])}catch(s){console.error("Erreur lors du chargement du planning:",s),l({title:"Erreur",description:"Impossible de charger le planning.",variant:"destructive"})}finally{m(!1)}},_=async s=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce créneau ?"))try{const{error:r}=await p.from("schedules").delete().eq("id",s);if(r)throw r;l({title:"Créneau supprimé",description:"Le créneau a été supprimé avec succès."}),x()}catch(r){console.error("Erreur lors de la suppression:",r),l({title:"Erreur",description:"Impossible de supprimer le créneau.",variant:"destructive"})}},v=s=>{switch(s){case"Compétition":return"bg-red-100 text-red-800";case"Loisir":return"bg-blue-100 text-blue-800";case"Perf":return"bg-green-100 text-green-800";case"Autonomes":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},N=s=>{const r=[s.instructor_1,s.instructor_2,s.instructor_3,s.instructor_4].filter(Boolean);return r.length===0?"Aucun":r.map(j=>`${j.first_name} ${j.last_name}`).join(", ")};return d||y?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(T,{className:"w-12 h-12 animate-spin text-primary"})}):i?e.jsxs("div",{className:"space-y-8",children:[e.jsxs(A,{children:[e.jsx("title",{children:"Gestion du Planning - Admin"}),e.jsx("meta",{name:"description",content:"Administration du planning des cours"})]}),e.jsx(g.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{variant:"ghost",onClick:()=>n("/schedule"),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Retour au planning"]}),e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(L,{className:"w-10 h-10 text-primary"}),"Gestion du Planning"]})]}),e.jsxs(c,{onClick:()=>n("/schedule/admin/new"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Nouveau créneau"]})]})}),e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(B,{children:["Liste des créneaux (",o.length,")"]})}),e.jsx(P,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(k,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Catégorie d'âge"}),e.jsx(a,{children:"Jour"}),e.jsx(a,{children:"Horaires"}),e.jsx(a,{children:"Encadrants"}),e.jsx(a,{className:"text-right",children:"Actions"})]})}),e.jsx(z,{children:o.length===0?e.jsx(h,{children:e.jsx(t,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:'Aucun créneau dans le planning. Cliquez sur "Nouveau créneau" pour commencer.'})}):o.map(s=>e.jsxs(h,{children:[e.jsx(t,{children:e.jsx(G,{className:v(s.type),children:s.type})}),e.jsx(t,{className:"font-medium",children:s.age_category}),e.jsx(t,{children:s.day}),e.jsxs(t,{className:"font-mono text-sm",children:[s.start_time.substring(0,5)," - ",s.end_time.substring(0,5)]}),e.jsx(t,{className:"text-sm",children:N(s)}),e.jsx(t,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>n(`/schedule/admin/edit/${s.id}`),children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx(c,{variant:"destructive",size:"sm",onClick:()=>_(s.id),children:e.jsx($,{className:"w-4 h-4"})})]})})]},s.id))})]})})})]})})]}):null};export{J as default};
