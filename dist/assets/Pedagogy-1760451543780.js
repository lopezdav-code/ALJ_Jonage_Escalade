import{x as ee,r as x,m as se,l as ae,u as te,Y as re,s as C,j as e,H as ie,o as p,d as N,q as le,n as ce,a9 as B,aa as J,ab as k,B as r,ac as A,ad as H,C as y,t as b,v as w,$ as P,w as _,Z as M,ae as O,a1 as T,af as U,ag as V,ah as $,P as G,T as W,M as ne,L as z,y as oe,ai as de}from"./index-1760451543780.js";import{B as me}from"./book-marked-1760451543780.js";const Y=ee("Puzzle",[["path",{d:"M19.439 7.85c-.049.322.059.648.289.878l1.568 1.568c.47.47.706 1.087.706 1.704s-.235 1.233-.706 1.704l-1.611 1.611a.98.98 0 0 1-.837.276c-.47-.07-.802-.48-.968-.925a2.501 2.501 0 1 0-3.214 3.214c.446.166.855.497.925.968a.979.979 0 0 1-.276.837l-1.61 1.61a2.404 2.404 0 0 1-1.705.707 2.402 2.402 0 0 1-1.704-.706l-1.568-1.568a1.026 1.026 0 0 0-.877-.29c-.493.074-.84.504-1.02.968a2.5 2.5 0 1 1-3.237-3.237c.464-.18.894-.527.967-1.02a1.026 1.026 0 0 0-.289-.877l-1.568-1.568A2.402 2.402 0 0 1 1.998 12c0-.617.236-1.234.706-1.704L4.23 8.77c.24-.24.581-.353.917-.303.515.077.877.528 1.073 1.01a2.5 2.5 0 1 0 3.259-3.259c-.482-.196-.933-.558-1.01-1.073-.05-.336.062-.676.303-.917l1.525-1.525A2.402 2.402 0 0 1 12 1.998c.617 0 1.234.236 1.704.706l1.568 1.568c.23.23.556.338.877.29.493-.074.84-.504 1.02-.968a2.5 2.5 0 1 1 3.237 3.237c-.464.18-.894.527-.967 1.02Z",key:"i0oyt7"}]]),Z="pedagogy_files",xe={educational_game:"Jeu éducatif",warm_up_exercise:"Exercice d'échauffement",strength_exercise:"Exercice de renfo",review_sheet:"Fiche de révision",technical_sheet:"Fiche technique",safety_sheet:"Fiche sécurité",meeting_report:"Compte rendu de réunion"},L={educational_game:{icon:O,label:"Jeux Éducatifs",description:"Jeux et activités ludiques pour l'apprentissage"},review_sheet:{icon:T,label:"Fiches de Révision",description:"Supports de révision et mémo techniques"},technical_sheet:{icon:U,label:"Fiches Techniques",description:"Techniques et méthodes d'escalade"},passeports:{icon:H,label:"Passeports",description:"Systèmes de validation des compétences FFME"},strength_exercise:{icon:V,label:"Exercices de Renfo",description:"Exercices de renforcement musculaire"},warm_up_exercise:{icon:$,label:"Exercices d'Échauffement",description:"Préparation physique et mentale"},safety_sheet:{icon:Y,label:"Fiches Sécurité",description:"Procédures et consignes de sécurité"},meeting_report:{icon:T,label:"Comptes Rendus",description:"Comptes rendus de réunions et assemblées"}},R=async s=>{if(!s)return null;try{if(s.startsWith("http://")||s.startsWith("https://"))return s;const{data:o,error:u}=await C.storage.from(Z).createSignedUrl(s,3600);if(u)throw u;return o.signedUrl}catch(o){return console.error("Erreur lors de la génération de l'URL signée:",o),null}},ue=({sheet:s,onEdit:o,onDelete:u,isAdmin:g})=>{const[d,h]=x.useState(null),[c,m]=x.useState(null);return x.useEffect(()=>{(async()=>{if(s.illustration_image){const f=await R(s.illustration_image);h(f)}if(s.url&&s.type==="image_file"){const f=await R(s.url);m(f)}})()},[s.url,s.type,s.illustration_image]),e.jsx(p.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(y,{className:"h-full flex flex-col group relative",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(w,{className:"text-lg leading-tight flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-purple-500"}),s.title]}),e.jsx("div",{className:"mt-1",children:e.jsx(r,{variant:"game",children:s.theme||"Jeu Éducatif"})})]}),g&&e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>o(s),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>u(s),children:e.jsx(W,{className:"h-4 w-4 text-destructive"})})]})]})}),e.jsxs(_,{className:"flex-grow space-y-4",children:[(d||c)&&e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2",children:d?"Illustration":"Image de l'exercice"}),e.jsx("div",{className:"w-full h-64 bg-muted rounded-md overflow-hidden",children:e.jsx("img",{src:d||c,alt:s.title,className:"w-full h-full object-cover"})})]}),d&&c&&e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Image de l'exercice"}),e.jsx("div",{className:"w-full h-48 bg-muted rounded-md overflow-hidden",children:e.jsx("img",{src:c,alt:s.title,className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"space-y-4",children:[s.starting_situation&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Situation de départ"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.starting_situation})]}),s.game_goal&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"But du jeu"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.game_goal})]}),s.evolution&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Évolution"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.evolution})]}),s.skill_to_develop&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Capacité à développer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.skill_to_develop})]}),s.success_criteria&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Critères de réussite"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.success_criteria})]}),s.remarks&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:"Remarques"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.remarks})]})]})]})]})})},D=({sheet:s,onEdit:o,onDelete:u,isAdmin:g})=>{const d=()=>{switch(s.type){case"video_url":return e.jsx(de,{className:"w-8 h-8 text-red-500"});case"image_file":return e.jsx(oe,{className:"w-8 h-8 text-blue-500"});case"document_file":case"document_url":return e.jsx(T,{className:"w-8 h-8 text-green-500"});default:return e.jsx(z,{className:"w-8 h-8 text-gray-500"})}},h=()=>{var m;if(s.thumbnail_url)return s.thumbnail_url;if(s.type==="image_file")return s.url;if(s.type==="video_url"){const j=((m=s.url.split("v=")[1])==null?void 0:m.split("&")[0])||s.url.split("/").pop();if(s.url.includes("youtube.com")||s.url.includes("youtu.be"))return`https://img.youtube.com/vi/${j}/mqdefault.jpg`}return null},c=()=>{switch(s.sheet_type){case"educational_game":return e.jsx(O,{className:"w-4 h-4"});case"warm_up_exercise":return e.jsx(V,{className:"w-4 h-4"});case"strength_exercise":return e.jsx($,{className:"w-4 h-4"});case"review_sheet":return e.jsx(U,{className:"w-4 h-4"});case"meeting_report":return e.jsx(T,{className:"w-4 h-4"});default:return null}};return s.sheet_type==="educational_game"?e.jsx(ue,{sheet:s,onEdit:o,onDelete:u,isAdmin:g}):e.jsx(p.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(y,{className:"h-full flex flex-col group relative",children:[e.jsxs(b,{className:"flex-row items-start gap-4",children:[h()?e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:h(),alt:s.title,className:"w-32 h-20 object-cover rounded-md"})}):e.jsx("div",{className:"w-32 h-20 flex items-center justify-center bg-muted rounded-md",children:d()}),e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{className:"text-lg leading-tight",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.sheet_type&&e.jsxs(r,{variant:"outline",className:"flex items-center gap-1",children:[c()," ",xe[s.sheet_type]]}),s.structure&&e.jsx(r,{variant:"secondary",children:s.structure}),(s.categories||[]).map(m=>e.jsx(r,{children:m},m))]})]}),g&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>o(s),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>u(s),children:e.jsx(W,{className:"h-4 w-4 text-destructive"})})]})]}),e.jsx(_,{className:"flex-grow",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})}),e.jsx(ne,{children:e.jsx(N,{asChild:!0,variant:"link",className:"p-0 h-auto",children:e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",children:["Ouvrir le média ",e.jsx(z,{className:"ml-2 h-4 w-4"})]})})})]})})},je=()=>{const[s,o]=x.useState([]),[u,g]=x.useState(!0),{isAdmin:d}=se(),{toast:h}=ae(),c=te(),[m,j]=re(),f=m.get("tab")||"educational_game",K=m.get("theme")||"",Q=x.useCallback(a=>{j({tab:a})},[j]),X=x.useCallback(a=>{j({tab:f,theme:a})},[j,f]),S=x.useCallback(async()=>{g(!0);const{data:a,error:l}=await C.from("pedagogy_sheets").select("*").order("created_at",{ascending:!1});l?h({title:"Erreur",description:"Impossible de charger les fiches pédagogiques.",variant:"destructive"}):o(a),g(!1)},[h]);x.useEffect(()=>{S()},[S]);const q=a=>{c(`/pedagogy/edit/${a.id}`)},F=async a=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer la fiche "${a.title}" ?`))try{if((a.type==="image_file"||a.type==="document_file")&&a.url){const t=a.url.split("/").pop();await C.storage.from(Z).remove([t])}const{error:l}=await C.from("pedagogy_sheets").delete().eq("id",a.id);if(l)throw l;h({title:"Fiche supprimée",variant:"destructive"}),S()}catch(l){h({title:"Erreur de suppression",description:l.message,variant:"destructive"})}},{sheetsByType:E,existingThemes:he}=x.useMemo(()=>{const a=s.reduce((t,n)=>{const i=n.sheet_type||"other";return t[i]||(t[i]=[]),t[i].push(n),t},{});if(a.educational_game){const t=a.educational_game.reduce((n,i)=>{const v=i.theme||"Sans thème";return n[v]||(n[v]=[]),n[v].push(i),n},{});a.educational_game=t}const l=[...new Set(s.filter(t=>t.sheet_type==="educational_game").map(t=>t.theme).filter(Boolean))];return{sheetsByType:a,existingThemes:l}},[s]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(ie,{children:[e.jsx("title",{children:"Fiches Pédagogiques - ALJ Escalade Jonage"}),e.jsx("meta",{name:"description",content:"Ressources et supports d'apprentissage pour l'escalade."})]}),e.jsx(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(me,{className:"w-10 h-10 text-primary"}),"Fiches Pédagogiques"]}),d&&e.jsxs(N,{onClick:()=>c("/pedagogy/new"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," Ajouter une fiche"]})]})}),u?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx(ce,{className:"w-12 h-12 animate-spin text-primary"})}):s.length===0?e.jsxs("div",{className:"text-center py-16 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-lg font-semibold",children:"Aucune fiche pédagogique pour le moment."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:'Cliquez sur "Ajouter une fiche" pour commencer à créer votre bibliothèque.'})]}):e.jsx(e.Fragment,{children:e.jsxs(B,{value:f,onValueChange:Q,className:"w-full",children:[e.jsx(J,{className:"grid grid-cols-2 md:grid-cols-4 w-full h-auto p-1",children:Object.entries(L).map(([a,l])=>{if(a==="passeports"){const i=l.icon;return e.jsxs(k,{value:a,className:"flex flex-col items-center gap-1 h-auto py-3 px-2 text-center min-h-[4rem]",children:[e.jsx(i,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-xs leading-tight",children:l.label}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"3"})]},a)}const t=a==="educational_game"?Object.values(E[a]||{}).flat().length:(E[a]||[]).length;if(t===0)return null;const n=l.icon;return e.jsxs(k,{value:a,className:"flex flex-col items-center gap-1 h-auto py-3 px-2 text-center min-h-[4rem]",children:[e.jsx(n,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-xs leading-tight",children:l.label}),e.jsx(r,{variant:"secondary",className:"text-xs",children:t})]},a)})}),e.jsx(A,{value:"passeports",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Passeports"}),e.jsx("p",{className:"text-muted-foreground",children:"Systèmes de validation des compétences FFME"})]})]}),e.jsxs(p.div,{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",initial:{opacity:0},animate:{opacity:1},children:[e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(y,{className:"h-full cursor-pointer hover:shadow-xl transition-all duration-300 border-2 hover:border-blue-500 bg-gradient-to-br from-blue-50 to-white group",onClick:()=>c("/passeport-guide"),children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex items-center gap-2 text-xl",children:[e.jsx("span",{className:"text-3xl",children:"⚪"}),e.jsx("span",{className:"group-hover:text-blue-600 transition-colors",children:"Passeport Blanc"})]}),e.jsx(P,{children:"Je grimpe en moulinette en autonomie sur SAE"})]}),e.jsxs(_,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(r,{variant:"outline",className:"text-sm",children:"39 compétences"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Validation en salle de bloc et voies en moulinette. Test de prise en charge et assurage."}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-xs font-semibold text-primary",children:"Modules :"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.jsx(r,{variant:"secondary",className:"text-xs",children:"Éco-responsabilité"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Bloc"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Difficulté"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Sécurité"})]})]})]})]})}),e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(y,{className:"h-full cursor-pointer hover:shadow-xl transition-all duration-300 border-2 hover:border-yellow-500 bg-gradient-to-br from-yellow-50 to-white group",onClick:()=>c("/passeport-guide"),children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex items-center gap-2 text-xl",children:[e.jsx("span",{className:"text-3xl",children:"🟡"}),e.jsx("span",{className:"group-hover:text-yellow-600 transition-colors",children:"Passeport Jaune"})]}),e.jsx(P,{children:"Je grimpe en tête sur SAE"})]}),e.jsxs(_,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(r,{variant:"outline",className:"text-sm",children:"38 compétences"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Validation en salle de bloc (niveau 4a) et voies en tête (niveau 5b). Test de prise en charge."}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-xs font-semibold text-primary",children:"Modules :"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.jsx(r,{variant:"secondary",className:"text-xs",children:"Éco-responsabilité"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Bloc"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Difficulté"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Sécurité"})]})]})]})]})}),e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(y,{className:"h-full cursor-pointer hover:shadow-xl transition-all duration-300 border-2 hover:border-orange-500 bg-gradient-to-br from-orange-50 to-white group",onClick:()=>c("/passeport-guide"),children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex items-center gap-2 text-xl",children:[e.jsx("span",{className:"text-3xl",children:"🟠"}),e.jsx("span",{className:"group-hover:text-orange-600 transition-colors",children:"Passeport Orange"})]}),e.jsx(P,{children:"Je grimpe en autonomie sur SAE"})]}),e.jsxs(_,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(r,{variant:"outline",className:"text-sm",children:"30 compétences"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Maîtrise complète de l'autonomie sur SAE incluant la gestion des relais et des techniques avancées."}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-xs font-semibold text-primary",children:"Compétences :"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.jsx(r,{variant:"secondary",className:"text-xs",children:"Relais"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Assurage"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Autonomie"}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Sécurité"})]})]})]})]})})]})]})}),Object.entries(L).map(([a,l])=>{const t=E[a];if(!t||Array.isArray(t)&&t.length===0||!Array.isArray(t)&&Object.keys(t).length===0)return null;const n=l.icon;return e.jsx(A,{value:a,className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:l.label}),e.jsx("p",{className:"text-muted-foreground",children:l.description})]})]}),a==="educational_game"?e.jsxs(B,{value:K||Object.keys(t)[0],onValueChange:X,className:"w-full",children:[e.jsx(J,{className:"w-full justify-start flex-wrap h-auto gap-2 p-2",children:Object.entries(t).map(([i,v])=>e.jsxs(k,{value:i,className:"flex items-center gap-2",children:[e.jsx("span",{children:i}),e.jsx(r,{variant:"outline",className:"text-xs",children:v.length})]},i))}),Object.entries(t).map(([i,v])=>e.jsx(A,{value:i,className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-2",children:i}),e.jsx(M,{children:e.jsx(p.div,{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(I=>e.jsx(D,{sheet:I,onEdit:q,onDelete:F,isAdmin:d},I.id))})})]})},i))]}):e.jsx(M,{children:e.jsx(p.div,{className:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(i=>e.jsx(D,{sheet:i,onEdit:q,onDelete:F,isAdmin:d},i.id))})})]})},a)})]})})]})};export{je as default};
