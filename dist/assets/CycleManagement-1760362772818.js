import{r as i,Q as $,O as H,u as P,t as d,j as e,R as D,U as R,m as b,B as r,P as A,C as E,e as S,V,W as G,b as J,d as Q,x as U,Y as W,Z as Y,f as Z,_ as K,z as X,E as ee,D as se,h as ae,i as ie,k as te,l as re,L as j,I as k,T as le,$ as ne}from"./index-1760362772818.js";import{A as ce,a as oe,b as de,c as me,d as xe,e as he,f as ue,g as pe}from"./alert-dialog-1760362772818.js";const fe=()=>{const[f,z]=i.useState([]),[F,v]=i.useState(!0),[I,m]=i.useState(!1),[c,x]=i.useState(null),[l,h]=i.useState(null),[y,C]=i.useState(!1),{user:L,isAdmin:N,isEncadrant:O}=$(),{toast:t}=H(),T=P(),[a,n]=i.useState({name:"",short_description:"",long_description:""}),u=N||O;i.useEffect(()=>{p()},[]);const p=async()=>{v(!0);try{const{data:s,error:o}=await d.from("cycles").select(`
          *,
          sessions:sessions(count)
        `).eq("is_active",!0).order("created_at",{ascending:!1});if(o)throw o;z(s||[])}catch(s){t({title:"Erreur",description:`Impossible de charger les cycles: ${s.message}`,variant:"destructive"})}finally{v(!1)}},g=(s=null)=>{s?(x(s),n({name:s.name,short_description:s.short_description||"",long_description:s.long_description||""})):(x(null),n({name:"",short_description:"",long_description:""})),m(!0)},w=()=>{m(!1),x(null),n({name:"",short_description:"",long_description:""})},q=async()=>{if(!a.name.trim()){t({title:"Erreur",description:"Le nom du cycle est obligatoire",variant:"destructive"});return}C(!0);try{if(c){const{error:s}=await d.from("cycles").update({name:a.name,short_description:a.short_description,long_description:a.long_description}).eq("id",c.id);if(s)throw s;t({title:"Succès",description:"Cycle mis à jour avec succès"})}else{const{error:s}=await d.from("cycles").insert({name:a.name,short_description:a.short_description,long_description:a.long_description,created_by:L.id});if(s)throw s;t({title:"Succès",description:"Cycle créé avec succès"})}w(),p()}catch(s){t({title:"Erreur",description:`Impossible de sauvegarder le cycle: ${s.message}`,variant:"destructive"})}finally{C(!1)}},B=async()=>{if(l)try{const{error:s}=await d.from("cycles").update({is_active:!1}).eq("id",l.id);if(s)throw s;t({title:"Succès",description:"Cycle archivé avec succès"}),h(null),p()}catch(s){t({title:"Erreur",description:`Impossible d'archiver le cycle: ${s.message}`,variant:"destructive"})}},M=s=>{T(`/cycles/${s}`)};return F?e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsx(D,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx("title",{children:"Gestion des Cycles - ALJ Escalade"})}),e.jsx("div",{className:"container mx-auto px-3 sm:px-4 py-4 sm:py-8 max-w-7xl",children:e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2",children:"Gestion des Cycles"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"Organisez vos séances en cycles thématiques"})]}),u&&e.jsxs(r,{onClick:()=>g(),size:"lg",className:"w-full sm:w-auto",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Nouveau Cycle"]})]}),f.length===0?e.jsx(E,{children:e.jsxs(S,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(V,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Aucun cycle pour le moment"}),u&&e.jsxs(r,{onClick:()=>g(),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Créer le premier cycle"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsx(G,{children:f.map(s=>{var o,_;return e.jsx(b.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:e.jsxs(E,{className:"hover:shadow-lg transition-shadow h-full flex flex-col",children:[e.jsxs(J,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 mb-2",children:[e.jsx(Q,{className:"text-lg sm:text-xl break-words",children:s.name}),e.jsxs(U,{variant:"secondary",className:"w-fit",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),((_=(o=s.sessions)==null?void 0:o[0])==null?void 0:_.count)||0," séances"]})]}),s.short_description&&e.jsx(Y,{className:"line-clamp-2 break-words",children:s.short_description})]}),e.jsx(S,{className:"flex-grow",children:s.long_description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3 break-words",children:s.long_description})}),e.jsxs(Z,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>M(s.id),className:"flex-1 sm:flex-initial w-full sm:w-auto",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Voir"]}),u&&e.jsxs("div",{className:"flex gap-2 flex-1 sm:flex-initial",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>g(s),className:"flex-1 sm:flex-initial",children:e.jsx(X,{className:"w-4 h-4"})}),N&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>h(s),className:"text-red-600 hover:text-red-700 flex-1 sm:flex-initial",children:e.jsx(ee,{className:"w-4 h-4"})})]})]})]})},s.id)})})})]})}),e.jsx(se,{open:I,onOpenChange:m,children:e.jsxs(ae,{className:"max-w-2xl",children:[e.jsxs(ie,{children:[e.jsx(te,{children:c?"Modifier le cycle":"Créer un nouveau cycle"}),e.jsx(re,{children:c?"Modifiez les informations du cycle":"Créez un nouveau cycle pour regrouper vos séances"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"name",children:"Nom du cycle *"}),e.jsx(k,{id:"name",value:a.name,onChange:s=>n({...a,name:s.target.value}),placeholder:"Ex: Initiation Bloc 2025"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"short_description",children:"Description courte"}),e.jsx(k,{id:"short_description",value:a.short_description,onChange:s=>n({...a,short_description:s.target.value}),placeholder:"Résumé en une phrase"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"long_description",children:"Description détaillée"}),e.jsx(le,{id:"long_description",value:a.long_description,onChange:s=>n({...a,long_description:s.target.value}),placeholder:"Décrivez les objectifs et le contenu du cycle...",rows:5})]})]}),e.jsxs(ne,{children:[e.jsx(r,{variant:"outline",onClick:w,children:"Annuler"}),e.jsxs(r,{onClick:q,disabled:y,children:[y&&e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),c?"Mettre à jour":"Créer"]})]})]})}),e.jsx(ce,{open:!!l,onOpenChange:()=>h(null),children:e.jsxs(oe,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"Archiver ce cycle ?"}),e.jsxs(xe,{children:['Le cycle "',l==null?void 0:l.name,'" sera archivé. Les séances associées ne seront pas supprimées. Cette action peut être annulée en restaurant le cycle depuis les archives.']})]}),e.jsxs(he,{children:[e.jsx(ue,{children:"Annuler"}),e.jsx(pe,{onClick:B,className:"bg-red-600 hover:bg-red-700",children:"Archiver"})]})]})})]})};export{fe as default};
