import{r as h,O as Y,u as Z,ah as $,t as ee,j as e,R as te,U as se,m as N,B as ae,a1 as ie,ai as re,a4 as ne,a5 as le,a6 as w,a7 as C,aj as ce,ak as oe,C as T,b as S,d as D,e as U,F as L,G as R,H as p,J as f,x as v,K as E,M as j,al as z,am as de}from"./index-1760361243512.js";import{C as K}from"./check-circle-2-1760361243512.js";const q={Bloc:"bloc",Difficulté:"difficulte",Vitesse:"vitesse"},V=({title:o,competitors:d,competitions:a})=>a.length===0?null:e.jsxs(T,{children:[e.jsx(S,{children:e.jsx(D,{children:o})}),e.jsx(U,{className:"overflow-x-auto",children:d.length>0?e.jsxs(L,{children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(f,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Compétiteur"}),a.map(s=>e.jsx(f,{className:"text-center min-w-[150px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:s.short_title||s.name}),e.jsx("div",{className:"text-xs text-muted-foreground font-normal",children:new Date(s.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[s.disciplines.map(t=>e.jsx(v,{variant:q[t]||"default",children:t.slice(0,4)},t)),s.nature&&e.jsx(v,{variant:"outline",children:s.nature})]})]})},s.id))]})}),e.jsx(E,{children:d.map(({member:s,participations:t})=>e.jsxs(p,{children:[e.jsx(j,{className:"font-medium sticky left-0 bg-background z-10",children:z(s.first_name,s.last_name,!0)}),a.map(n=>e.jsx(j,{className:"text-center",children:t[n.id]?t[n.id].ranking?e.jsxs("div",{className:"flex items-center justify-center gap-1 font-bold text-primary",children:[e.jsx(de,{className:"w-4 h-4"}),t[n.id].ranking]}):e.jsx(K,{className:"w-5 h-5 text-green-500 mx-auto"}):null},n.id))]},s.id))})]}):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Aucun compétiteur dans ce groupe."})})]}),P=({title:o,competitors:d,competitions:a})=>a.length===0||d.length===0?null:e.jsxs(T,{children:[e.jsx(S,{children:e.jsx(D,{children:o})}),e.jsx(U,{className:"overflow-x-auto",children:e.jsxs(L,{children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(f,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Compétiteur"}),a.map(s=>e.jsx(f,{className:"text-center min-w-[150px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:s.short_title||s.name}),e.jsx("div",{className:"text-xs text-muted-foreground font-normal",children:new Date(s.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[s.disciplines.map(t=>e.jsx(v,{variant:q[t]||"default",children:t.slice(0,4)},t)),s.nature&&e.jsx(v,{variant:"outline",children:s.nature})]})]})},s.id)),e.jsx(f,{className:"text-right font-bold sticky right-0 bg-background z-10 min-w-[100px]",children:"Total"})]})}),e.jsx(E,{children:d.map(({member:s,participations:t})=>{let n=0;return a.forEach(l=>{t[l.id]&&l.prix>0&&(n+=l.prix)}),n===0?null:e.jsxs(p,{children:[e.jsx(j,{className:"font-medium sticky left-0 bg-background z-10",children:z(s.first_name,s.last_name,!0)}),a.map(l=>e.jsx(j,{className:"text-center",children:t[l.id]&&l.prix>0?l.prix.toLocaleString("fr-FR",{style:"currency",currency:"EUR"}):""},l.id)),e.jsx(j,{className:"text-right font-bold sticky right-0 bg-background z-10 text-primary",children:n.toLocaleString("fr-FR",{style:"currency",currency:"EUR"})})]},s.id)})})]})})]}),J=({title:o,volunteers:d,competitions:a,icon:s})=>a.length===0||d.length===0?null:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[s&&e.jsx(s,{className:"w-6 h-6"}),o]})}),e.jsx(U,{className:"overflow-x-auto",children:e.jsxs(L,{children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(f,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Bénévole"}),a.map(t=>e.jsx(f,{className:"text-center min-w-[150px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:t.short_title||t.name}),e.jsx("div",{className:"text-xs text-muted-foreground font-normal",children:new Date(t.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})})]})},t.id)),e.jsx(f,{className:"text-right font-bold sticky right-0 bg-background z-10 min-w-[100px]",children:"Total"})]})}),e.jsx(E,{children:d.map(({member:t,participations:n})=>{const l=Object.keys(n).length;return l===0?null:e.jsxs(p,{children:[e.jsx(j,{className:"font-medium sticky left-0 bg-background z-10",children:z(t.first_name,t.last_name,!0)}),a.map(g=>e.jsx(j,{className:"text-center",children:n[g.id]&&e.jsx(K,{className:"w-5 h-5 text-green-500 mx-auto"})},g.id)),e.jsx(j,{className:"text-right font-bold sticky right-0 bg-background z-10 text-primary",children:l})]},t.id)})})]})})]}),xe=()=>{const[o,d]=h.useState({u11_u15:[],u15_u19:[]}),[a,s]=h.useState({coaches:[],referees:[]}),[t,n]=h.useState({u11_u15:[],u15_u19:[],all:[]}),[l,g]=h.useState(!0),{toast:F}=Y(),Q=Z(),A=$(),[W,I]=h.useState("participation");h.useEffect(()=>{const y=new URLSearchParams(A.search).get("tab");y&&I(y)},[A.search]);const O=h.useCallback(async()=>{g(!0);try{const{data:b,error:y}=await ee.from("competition_participants").select(`
          role,
          member_id,
          competition_id,
          ranking,
          members ( id, first_name, last_name, title ),
          competitions ( id, name, short_title, start_date, disciplines, nature, prix )
        `);if(y)throw y;const X=b.map(m=>m.competitions).filter((m,c,i)=>m&&i.findIndex(x=>x.id===m.id)===c).sort((m,c)=>new Date(m.start_date)-new Date(c.start_date)),B=m=>{const c={},i={};b.filter(r=>{var u;return r.role==="Competiteur"&&((u=r.members)==null?void 0:u.title)===m}).forEach(r=>{if(!r.members||!r.competitions)return;const u=r.members.id,k=r.competitions.id;c[u]||(c[u]={member:r.members,participations:{}}),c[u].participations[k]={ranking:r.ranking},i[k]||(i[k]=r.competitions)});const x=Object.values(c).sort((r,u)=>r.member.first_name.localeCompare(u.member.first_name)),_=Object.values(i).sort((r,u)=>new Date(r.start_date)-new Date(u.start_date));return{members:x,competitions:_}},G=m=>{const c={};return b.filter(i=>i.role===m).forEach(i=>{if(!i.members||!i.competitions)return;const x=i.members.id,_=i.competitions.id;c[x]||(c[x]={member:i.members,participations:{}}),c[x].participations[_]=!0}),Object.values(c).sort((i,x)=>i.member.first_name.localeCompare(x.member.first_name))},H=B("Compétition U11-U15"),M=B("Compétition U15-U19");d({u11_u15:H.members,u15_u19:M.members}),n({u11_u15:H.competitions,u15_u19:M.competitions,all:X}),s({coaches:G("Coach"),referees:G("Arbitre")})}catch{F({title:"Erreur",description:"Impossible de charger les données du récapitulatif.",variant:"destructive"})}finally{g(!1)}},[F]);return h.useEffect(()=>{O()},[O]),l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(te,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs(se,{children:[e.jsx("title",{children:"Récapitulatif Annuel et Financier - ALJ Escalade Jonage"}),e.jsx("meta",{name:"description",content:"Récapitulatif annuel des participations aux compétitions et suivi financier."})]}),e.jsx(N.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ae,{variant:"ghost",size:"icon",onClick:()=>Q("/competitions"),children:e.jsx(ie,{})}),e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(re,{className:"w-10 h-10 text-primary"}),"Récapitulatif Annuel et Financier"]})]})}),e.jsxs(ne,{value:W,onValueChange:I,children:[e.jsxs(le,{children:[e.jsx(w,{value:"participation",children:"Liste des compétitions"}),e.jsx(w,{value:"financial",children:"Récapitulatif Financier"}),e.jsx(w,{value:"volunteers",children:"Participation des bénévoles"})]}),e.jsx(C,{value:"participation",className:"pt-4",children:e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-8",children:[e.jsx(V,{title:"Groupe U11-U15",competitors:o.u11_u15,competitions:t.u11_u15}),e.jsx(V,{title:"Groupe U15-U19",competitors:o.u15_u19,competitions:t.u15_u19})]})}),e.jsx(C,{value:"financial",className:"pt-4",children:e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-8",children:[e.jsx(P,{title:"Groupe U11-U15",competitors:o.u11_u15,competitions:t.u11_u15}),e.jsx(P,{title:"Groupe U15-U19",competitors:o.u15_u19,competitions:t.u15_u19})]})}),e.jsx(C,{value:"volunteers",className:"pt-4",children:e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-8",children:[e.jsx(J,{title:"Coachs",volunteers:a.coaches,competitions:t.all,icon:ce}),e.jsx(J,{title:"Arbitres",volunteers:a.referees,competitions:t.all,icon:oe})]})})]})]})};export{xe as default};
