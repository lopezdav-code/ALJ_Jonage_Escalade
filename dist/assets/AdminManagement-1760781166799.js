import{x as U,w as I,ax as T,r as v,j as e,z as w,H as z,D as i,G as l,J as d,K as o,ah as u,W as x,aC as j,m,o as H,p as V,q as A,s as n,t as F,v as S,a0 as M,$ as R,aD as J,aE as O,B as p}from"./index-1760781166799.js";import"./alert-dialog-1760781166799.js";import{U as k}from"./user-cog-1760781166799.js";import{S as K}from"./save-1760781166799.js";import{C as W}from"./calendar-check-1760781166799.js";const $=[{to:"/user-roles",text:"Gestion des Rôles"},{to:"/news",text:"Actualités"},{to:"/schedule",text:"Planning"},{to:"/inscriptions",text:"Inscription"},{to:"/contact",text:"Contact"},{to:"/volunteers",text:"Adhérents"},{to:"/competitions",text:"Compétitions"},{to:"/agenda",text:"Agenda"},{to:"/session-log",text:"Séances"},{to:"/cycles",text:"Cycles"},{to:"/pedagogy",text:"Pédagogie"},{to:"/passeport-viewer",text:"Passeports - Visualisation"},{to:"/passeport-guide",text:"Passeports - Guide"},{to:"/passeport-validation",text:"Passeports - Validation"},{to:"/annual-summary",text:"Récapitulatif Annuel"}],se=()=>{const{isAdmin:L,loading:G}=U(),{toast:y}=I(),{config:g,updateConfig:B,loadingConfig:f}=T(),q=s=>{switch(s){case"/news":case"/schedule":case"/inscriptions":case"/contact":case"/agenda":return["public","user","adherent","bureau","encadrant","admin"];case"/volunteers":case"/competitions":case"/session-log":case"/cycles":case"/pedagogy":case"/passeport-viewer":case"/annual-summary":return["adherent","bureau","encadrant","admin"];case"/passeport-validation":return["encadrant","admin"];default:return["adherent","bureau","encadrant","admin"]}},[b,N]=v.useState($.map(s=>({to:s.to,text:s.text,roles:q(s.to)}))),[C,P]=v.useState(!1);v.useEffect(()=>{if(!f&&g.nav_config)try{const s=JSON.parse(g.nav_config);N(a=>{const t=[...a];return s.forEach(r=>{const c=t.findIndex(h=>h.to===r.to);c!==-1&&(t[c].roles=r.roles)}),t})}catch(s){console.error("Failed to parse nav_config:",s)}},[g.nav_config,f]);const _=(s,a,t)=>{N(r=>{const c=[...r],h=c[s].roles;return t?h.includes(a)||h.push(a):c[s].roles=h.filter(E=>E!==a),c})},D=async()=>{P(!0);const{error:s}=await B("nav_config",JSON.stringify(b));y(s?{title:"Erreur",description:"Impossible de sauvegarder la configuration du menu.",variant:"destructive"}:{title:"Succès",description:"Configuration du menu sauvegardée."}),P(!1)};return G||f?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(w,{className:"w-12 h-12 animate-spin text-primary"})}):L?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(z,{children:e.jsx("title",{children:"Gestion des Rôles et Accès"})}),e.jsx(i.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold headline flex items-center gap-3",children:[e.jsx(k,{className:"w-10 h-10 text-primary"}),"Gestion des Accès"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gérez les accès aux différentes pages du site."})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Gestion des Rôles Utilisateurs"}),e.jsx(u,{children:"La gestion des rôles a été déplacée vers une page dédiée pour plus de clarté."})]}),e.jsx(x,{children:e.jsx(j,{to:"/user-roles",children:e.jsxs(m,{variant:"outline",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Aller à la Gestion des Rôles"]})})})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Accès aux Pages du Menu"}),e.jsx(u,{children:"Définissez quels rôles peuvent voir chaque page dans le menu principal."})]}),e.jsx(x,{children:e.jsxs(H,{children:[e.jsx(V,{children:e.jsxs(A,{children:[e.jsx(n,{children:"Page"}),e.jsx(n,{className:"text-center",children:"Public"}),e.jsx(n,{className:"text-center",children:"Utilisateur"}),e.jsx(n,{className:"text-center",children:"Adhérent"}),e.jsx(n,{className:"text-center",children:"Bureau"}),e.jsx(n,{className:"text-center",children:"Encadrant"}),e.jsx(n,{className:"text-center",children:"Admin"})]})}),e.jsx(F,{children:b.map((s,a)=>e.jsxs(A,{children:[e.jsx(S,{className:"font-medium",children:s.text}),["public","user","adherent","bureau","encadrant","admin"].map(t=>e.jsx(S,{className:"text-center",children:e.jsx(M,{checked:s.roles.includes(t),onCheckedChange:r=>_(a,t,r)})},t))]},s.to))})]})}),e.jsx(R,{children:e.jsxs(m,{onClick:D,disabled:C,children:[C?e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(K,{className:"w-4 h-4 mr-2"}),"Sauvegarder les Accès du Menu"]})})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Outils de Base de Données"}),e.jsx(u,{children:"Gérez et consultez la structure de votre base de données."})]}),e.jsx(x,{children:e.jsx(j,{to:"/database-schema",children:e.jsxs(m,{variant:"outline",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Voir le Schéma de la Base de Données"]})})})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Permissions Détaillées"}),e.jsx(u,{children:"Gérez finement les droits de création et de modification pour chaque rôle."})]}),e.jsx(x,{children:e.jsx(j,{to:"/permissions",children:e.jsxs(m,{variant:"outline",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Aller à la Gestion des Permissions"]})})}),e.jsx(R,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Protection des données :"})," Pour protéger les données personnelles, le nom de famille des adhérents est masqué pour tous les rôles sauf 'Admin' et 'Bureau'. Cette logique est appliquée directement par la base de données via une vue sécurisée (`secure_members`)."]})})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Récapitulatif de Présence"}),e.jsx(u,{children:"Consultez les présences des élèves par planning et par séance."})]}),e.jsx(x,{children:e.jsx(j,{to:"/attendance-recap",children:e.jsxs(m,{variant:"outline",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Voir le Récapitulatif de Présence"]})})})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Gestion des Images et de la Sécurité"}),e.jsx(u,{children:"Récapitulatif des buckets de stockage et de leur configuration de sécurité."})]}),e.jsxs(x,{className:"text-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Photos des Membres"}),e.jsxs("div",{className:"text-muted-foreground",children:["- ",e.jsx("strong",{children:"Bucket :"})," `members_photos` ",e.jsx(p,{variant:"destructive",children:"Privé"}),e.jsx("br",{}),"- ",e.jsx("strong",{children:"Sécurité :"})," L'accès aux photos est protégé. Le code génère des URLs sécurisées et temporaires (`signed URLs`) pour chaque image. C'est la configuration correcte et la plus sécurisée pour les données personnelles."]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Images des Actualités (News)"}),e.jsxs("div",{className:"text-muted-foreground",children:["- ",e.jsx("strong",{children:"Bucket :"})," `news` ",e.jsx(p,{variant:"secondary",children:"Public"}),e.jsx("br",{}),"- ",e.jsx("strong",{children:"Sécurité :"})," Le bucket est public. Le code utilise des URLs publiques directes, ce qui est optimal pour des images non sensibles."]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Images des Compétitions"}),e.jsxs("div",{className:"text-muted-foreground",children:["- ",e.jsx("strong",{children:"Bucket :"})," `competition_photos` ",e.jsx(p,{variant:"destructive",children:"Privé"}),e.jsx("br",{}),"- ",e.jsx("strong",{children:"Sécurité :"})," L'accès est restreint aux utilisateurs authentifiés via des URLs signées."]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Autres Images (Pédagogie, Cycles, etc.)"}),e.jsxs("div",{className:"text-muted-foreground",children:["- ",e.jsx("strong",{children:"Buckets :"})," `pedagogy_files`, `cycles`, etc. ",e.jsx(p,{variant:"secondary",children:"Publics"}),e.jsx("br",{}),"- ",e.jsx("strong",{children:"Sécurité :"})," Ces buckets sont publics. Le code utilise des URLs publiques directes."]})]})]})]})})]})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Accès non autorisé"}),e.jsx("p",{className:"text-muted-foreground",children:"Cette page est réservée aux administrateurs."})]})};export{se as default};
