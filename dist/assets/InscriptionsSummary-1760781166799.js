import{Y as y,r as l,w as _,j as e,z as E,H as T,D as x,m as k,a9 as B,y as u,G as I,J as q,K as H,W as L,o as M,p as R,q as f,s as h,t as S,v as j,aB as A,ac as G}from"./index-1760781166799.js";import{C as z}from"./check-circle-2-1760781166799.js";const F=y("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),V=y("Mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]),P=()=>{const[g,N]=l.useState([]),[b,C]=l.useState([]),[w,n]=l.useState(!0),{toast:m}=_();l.useEffect(()=>{(async()=>{n(!0);const{data:i,error:a}=await u.from("competitions").select("id, name, start_date, categories, disciplines").order("start_date",{ascending:!0});if(a){m({title:"Erreur",description:"Impossible de charger les compétitions.",variant:"destructive"}),n(!1);return}N(i);const{data:r,error:s}=await u.from("competition_participants").select("competition_id, role, members(id, first_name, last_name, category)").eq("role","Competiteur");if(s){m({title:"Erreur",description:"Impossible de charger les participants.",variant:"destructive"}),n(!1);return}C(r),n(!1)})()},[m]);const v=c=>{const i=g.filter(s=>s.disciplines.includes(c));if(i.length===0)return{competitors:[],competitions:[]};const a=new Map;return b.forEach(s=>{if(i.some(t=>t.id===s.competition_id)){if(!s.members)return;const t=s.members.id;a.has(t)||a.set(t,{member:s.members,inscriptions:new Array(i.length).fill(!1)});const o=i.findIndex(p=>p.id===s.competition_id);o!==-1&&(a.get(t).inscriptions[o]=!0)}}),{competitors:Array.from(a.values()).sort((s,t)=>s.member.last_name.localeCompare(t.member.last_name)),competitions:i}},d=({title:c,discipline:i})=>{const{competitors:a,competitions:r}=v(i);if(r.length===0)return null;const s=i==="Bloc"?V:i==="Difficulté"?F:G;return e.jsxs(I,{children:[e.jsx(q,{children:e.jsxs(H,{className:"flex items-center gap-3",children:[e.jsx(s,{className:`w-6 h-6 ${i==="Bloc"?"text-purple-500":"text-green-500"}`}),c]})}),e.jsx(L,{children:a.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(M,{children:[e.jsx(R,{children:e.jsxs(f,{children:[e.jsx(h,{className:"w-[200px] min-w-[150px]",children:"Compétiteur"}),r.map(t=>e.jsx(h,{className:"text-center min-w-[100px]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:t.name}),e.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:new Date(t.start_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})})]})},t.id))]})}),e.jsx(S,{children:a.map(({member:t,inscriptions:o})=>e.jsxs(f,{children:[e.jsx(j,{className:"font-medium",children:A(t.first_name,t.last_name,!0)}),o.map((p,D)=>e.jsx(j,{className:"text-center",children:p&&e.jsx(z,{className:"w-5 h-5 text-green-500 mx-auto"})},D))]},t.id))})]})}):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Aucun compétiteur inscrit pour cette discipline."})})]})};return w?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(E,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs(T,{children:[e.jsx("title",{children:"Récapitulatif par Compétiteur - Club d'Escalade"}),e.jsx("meta",{name:"description",content:"Tableau récapitulatif des inscriptions par compétiteur et par discipline"})]}),e.jsxs(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"flex items-center gap-4",children:[e.jsxs(k,{variant:"ghost",onClick:()=>window.history.back(),className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold headline",children:"Inscriptions par Compétiteur"}),e.jsx("p",{className:"text-xl text-muted-foreground mt-2",children:"Qui participe à quelle compétition ?"})]})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"space-y-12",children:[e.jsx(d,{title:"Discipline Bloc",discipline:"Bloc"}),e.jsx(d,{title:"Discipline Difficulté",discipline:"Difficulté"}),e.jsx(d,{title:"Discipline Vitesse",discipline:"Vitesse"})]})]})};export{P as default};
